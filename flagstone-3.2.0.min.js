/*
  FlagstoneJS v3.2.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=x.length;e<t;e++)Math.random()<z&&x.splice(e,0,!1)}function a(){y.style.visibility="hidden"}function o(){var t=[T],n=0,r=C.length;for(M=[];n<r;n++){if(n<T)x[n]?(x[n].style.top=L+"px",x[n].style[B]=w*n+(n?k*n+L:L)+"px",_&&(x[n].style.height=x[n].style.width),t[n]=C[n]+L,U(x[n],n),M.push([x[n]])):T>1&&(t[n]=w+L);else{var a=Math.min.apply(null,t),o=t.indexOf(a);x[n]?(x[n].style.top=a+k+"px",x[n].style[B]=w*o+(o?k*o+L:L)+"px",_&&(x[n].style.height=x[n].style.width),t[o]+=C[n]+k,U(x[n],n),M[o].push(x[n])):T>1&&(t[o]+=w+k)}y.style.height=(Math.max.apply(null,t)||C[0]+L)+L+"px"}e.setTimeout(function(){y.style.visibility="visible"})}function s(e){if(x.length){E=y.getBoundingClientRect().width,E<S+(L?2*L:0)&&(E=S),D=Math.floor(E/S),T=D>b?b:D,w=E/T-(k*(T-1)+2*L)/T,C=[];for(var t=0,n=x.length;t<n;t++)x[t]&&(x[t].style.width=w+"px",x[t].style.margin="0px"),C.push(_||!x[t]?w:x[t].offsetHeight);E===y.getBoundingClientRect().width||e?o():s(!0)}}function i(){var t=Date.now(),n=y.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,i=n.length;o<i;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+q<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){s(!0)}))},I)}()}function g(e){if("keydown"!==e.type||13===e.keyCode||32===e.keyCode){for(var t=e.target;t&&!t.classList.contains(A);)t=t.parentElement;y.removeChild(t)}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(s,Q)}function l(t){function n(){o=r.getBoundingClientRect().height;var t=o-a;for(g=0;g<l;g++)s[g].style.marginTop=e.parseFloat(s[g].style.marginTop)+t+"px";a=o,G=e[(J?"request":"cancel")+"AnimationFrame"](n)}if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var r=t.target;r&&!r.classList.contains(A);)r=r.parentElement;for(var a=r.getBoundingClientRect().height,o=0,s=[],i=!1,g=0,d=0,l=M.length,m=0;g<l&&!i;g++)for(d=0,m=M[g].length;d<m;d++)i&&s.push(M[g][d]),M[g][d]===r&&(i=!0);l=s.length,J=!1,e.cancelAnimationFrame(G),e.clearTimeout(K),J=!0,G=e.requestAnimationFrame(n),K=e.setTimeout(function(){J=!1,e.cancelAnimationFrame(G)},j)}}function m(){x=Array.prototype.slice.call(y.children);for(var t=0,n=x.length;t<n;t++)x[t].classList.add(A);for(t=0;t<n;t++)x[t].setAttribute("draggable","false"),x[t].removeEventListener("dragstart",Z.dragStart),x[t].removeEventListener("dragover",Z.dragOver),x[t].removeEventListener("dragleave",Z.dragLeave),x[t].removeEventListener("dragend",Z.dragEnd),x[t].removeEventListener("drop",Z.drop),x[t].removeEventListener("dragenter",Z.dragEnter),y.removeEventListener("dragover",Z.dragOver),y.removeEventListener("drop",Z.drop);if(W)for(t=0;t<n;t++)x[t].setAttribute("draggable","true"),x[t].addEventListener("dragstart",Z.dragStart),x[t].addEventListener("dragover",Z.dragOver),x[t].addEventListener("dragleave",Z.dragLeave),x[t].addEventListener("dragend",Z.dragEnd),x[t].addEventListener("drop",Z.drop),H&&x[t].addEventListener("dragenter",Z.dragEnter),y.addEventListener("dragover",Z.dragOver),y.addEventListener("drop",Z.drop);(P||O)&&(P&&x.sort(function(){return.5-Math.random()}),O&&r());var a=y.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=y.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=y.getElementsByClassName("flagstone-resize"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",l),a[t].addEventListener("click",l),a[t].removeEventListener("keydown",l),a[t].addEventListener("keydown",l);s(),F&&e.setTimeout(i,F),e.setTimeout(function(){s(!0)},F)}function f(){e.clearTimeout(V),V=e.setTimeout(s,X)}function c(){a(),e.clearTimeout(Y),Y=e.setTimeout(m)}function v(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+p+"-styles"))}function u(e){e.margin||0===e.margin?(L=e.margin,k=e.margin):(L=e.bedPadding||L,k=e.stonesMargin||k),S=e.minWidth||S,b=e.maxColumns||b,W=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:W,U=e.callback||U,m()}var p=e.flagstone.index,h=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},y=h.elem,L=h.margin||0===h.margin?h.margin:h.bedPadding||0===h.bedPadding?h.bedPadding:10,E=0,S=h.minWidth||280,b=h.maxColumns||5,D=0,T=0,x=[],k=h.margin||0===h.margin?h.margin:h.stonesMargin||0===h.stonesMargin?h.stonesMargin:10,w=E/T-k*(T+1)/T,C=[],M=[],A="flagstone-"+p+"-bed__stone",B=h.direction?h.direction.toLowerCase():"left",P=h.random,z=h.spaceFrequency||.4,O=h.space,F=h.animationDuration||0,N=h.animationDuration?h.animationDuration/1e3:0,R=h.animationTimingFunction||"linear",X=h.resizeDelay||0===h.resizeDelay?h.resizeDelay:250,_=h.square,q=h.imagesLoadedQueryDuration||2500,I=h.imagesLoadedQueryFrequency||100,W=h.dragAndDrop,H=h.dragAndDropAutoDelay,Q=h.eventResetDelay||0,j=h.eventResizeDuration||0,G=null,J=!1,K=null,U=h.callback||function(){},V=null,Y=null,Z={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,autoDrop:function(){Z.targetStone.classList.contains(A)&&(Z.targetStoneMouseXPercent<.5?Z.targetStone.parentElement.insertBefore(Z.dragStone,Z.targetStone):Z.targetStone.parentElement.insertBefore(Z.dragStone,Z.targetStone.nextElementSibling),Z.targetStone.classList.remove("flagstone-dragover"),Z.targetStone.classList.remove("flagstone-left"),Z.targetStone.classList.remove("flagstone-right"),e.clearTimeout(Z.autoDropTimer),Z.autoDropTimer=e.setTimeout(Z.autoDrop,H))},autoDropTimer:null,dragStart:function(e){e.dataTransfer.setData("text",this.id),Z.dragStone=this,Z.dragStone.classList.add("flagstone-drag")},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==Z.dragStone&&this!==Z.targetStone&&this!==y&&(e.clearTimeout(Z.autoDropTimer),Z.autoDropTimer=e.setTimeout(Z.autoDrop,H))},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==Z.dragStone&&this.hasAttribute("draggable")?(Z.targetStone=this,Z.targetStone.classList.add("flagstone-dragover"),Z.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,Z.targetStoneMouseXPercent<.5?(Z.targetStone.classList.remove("flagstone-right"),Z.targetStone.classList.add("flagstone-left")):(Z.targetStone.classList.remove("flagstone-left"),Z.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===y&&this.classList.add("flagstone-dragover")},dragEnd:function(){Z.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){Z.targetStone&&(y.classList.remove("flagstone-dragover"),Z.targetStone.classList.remove("flagstone-dragover"),Z.targetStone.classList.remove("flagstone-left"),Z.targetStone.classList.remove("flagstone-right"))},drop:function(t){return t.stopPropagation(),e.clearTimeout(Z.autoDropTimer),Z.dragStone===this||!this.hasAttribute("draggable")&&this!==y||(Z.targetStone=this,Z.targetStone===y?Z.targetStone.appendChild(Z.dragStone):Z.targetStoneMouseXPercent<.5?Z.targetStone.parentElement.insertBefore(Z.dragStone,Z.targetStone):Z.targetStone.parentElement.insertBefore(Z.dragStone,Z.targetStone.nextElementSibling),Z.targetStone.classList.remove("flagstone-dragover"),Z.targetStone.classList.remove("flagstone-left"),Z.targetStone.classList.remove("flagstone-right"),Z.dragStone.classList.remove("flagstone-drag")),!1}};return function(){if(y.classList.add("flagstone-"+p+"-bed"),!t.getElementById("flagstone-"+p+"-styles")){var n=".flagstone-"+p+"-bed{box-sizing:border-box;list-style-type:none;position:relative;margin:0;padding:0;min-width:"+(S+2*k)+"px;}",r=".flagstone-"+p+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+B+":0px;margin:0;}",a=".flagstone-"+p+"-bed__stone{-webkit-transition:top "+N+"s "+R+",left "+N+"s "+R+",right "+N+"s "+R+";-moz-transition:top "+N+"s "+R+",left "+N+"s "+R+",right "+N+"s "+R+";-ms-transition:top "+N+"s "+R+",left "+N+"s "+R+",right "+N+"s "+R+";-o-transition:top "+N+"s "+R+",left "+N+"s "+R+",right "+N+"s "+R+";transition:top "+N+"s "+R+",left "+N+"s "+R+",right "+N+"s "+R+";}",o=n+r+a,s=t.createElement("style");s.type="text/css",s.id="flagstone-"+p+"-styles",s.appendChild(t.createTextNode(o)),t.head.appendChild(s)}if(m(),e.removeEventListener("resize",f),e.addEventListener("resize",f),e.MutationObserver){var i=new MutationObserver(c);i.observe(y,{childList:!0})}}(),{adjust:u,destroy:v,hide:a,reset:f,hardReset:m}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);