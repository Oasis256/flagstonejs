/*
  FlagstoneJS v3.0.0-rc.1
  (c) 2015-2016 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function a(n){function a(){for(var e=0,t=E.length;e<t;e++)Math.random()<C&&E.splice(e,0,!1)}function r(){m.classList.add("flagstone-"+c+"-bed-hidden")}function s(e){for(var t=e.target,n="flagstone-"+c+"-bed__stone";t&&!t.classList.contains(n);)t=t.parentElement;t&&t.classList.contains(n)&&m.removeChild(t)}function o(){for(var t=[y],n=0,a=w.length;n<a;n++){if(n<y)if(E[n]){var r=E[n].style.width.toString().replace(/(\d+).+/,"$1");E[n].style.width=r+"px",E[n].style.top=u+"px",E[n].style[M]=x*n+(n?b*n+u:u)+"px",_&&(E[n].style.height=r+"px"),t[n]=w[n]+u,k(n,E[n])}else y>1&&(t[n]=x+u);else{var s=Math.min.apply(null,t),o=t.indexOf(s);if(E[n]){var i=E[n].style.width.toString().replace(/(\d+).+/,"$1");E[n].style.width=i+"px",E[n].style.top=s+b+"px",E[n].style[M]=x*o+(o?b*o+u:u)+"px",_&&(E[n].style.height=i+"px"),t[o]+=w[n]+b,k(n,E[n])}else y>1&&(t[o]+=x+b)}m.style.height=(Math.max.apply(null,t)||w[0]+u)+u+"px"}e.setTimeout(function(){m.classList.remove("flagstone-"+c+"-bed-hidden")})}function i(e){if(E.length){h=m.getBoundingClientRect().width,h<p+(u?2*u:0)&&(h=p),S=Math.floor(h/p),y=S>L?L:S,x=h/y-(b*(y-1)+2*u)/y,w=[];for(var t=0,n=E.length;t<n;t++)E[t]&&(E[t].style.width=x+"px"),w.push(_||!E[t]?x:E[t].offsetHeight);h===m.getBoundingClientRect().width||e?o():i(!0)}}function d(){var t=Date.now(),n=m.getElementsByTagName("img");n.length&&!function(){var a=e.setInterval(function(){for(var r=[],s=0,o=n.length;s<o;s++)r[s]=n[s].naturalHeight;(r.indexOf(0)===-1||t+A<Date.now())&&(e.clearInterval(a),e.setTimeout(function(){i(!0)}))},N)}()}function g(){r(),m.classList.add("flagstone-"+c+"-bed"),E=Array.prototype.slice.call(m.children);for(var t=0,n=E.length;t<n;t++)E[t].classList.add("flagstone-"+c+"-bed__stone");if(X){for(t=0;t<n;t++)E[t].setAttribute("draggable","true"),E[t].removeEventListener("dragstart",F.dragStart),E[t].addEventListener("dragstart",F.dragStart),E[t].removeEventListener("dragover",F.dragOver),E[t].addEventListener("dragover",F.dragOver),E[t].removeEventListener("dragleave",F.dragLeave),E[t].addEventListener("dragleave",F.dragLeave),E[t].removeEventListener("dragend",F.dragEnd),E[t].addEventListener("dragend",F.dragEnd),E[t].removeEventListener("drop",F.drop),E[t].addEventListener("drop",F.drop);m.removeEventListener("dragover",F.dragOver),m.addEventListener("dragover",F.dragOver),m.removeEventListener("drop",F.drop),m.addEventListener("drop",F.drop)}(D||T)&&(E=Array.prototype.slice.call(E),D&&E.sort(function(){return.5-Math.random()}),T&&a());var o=m.getElementsByClassName("flagstone-remove");for(t=0,n=o.length;t<n;t++)o[t].removeEventListener("click",s),o[t].addEventListener("click",s);i(),P&&e.setTimeout(d,P),e.setTimeout(function(){i(!0)},P)}function l(){e.clearTimeout(q),q=e.setTimeout(i,O)}function f(){e.removeEventListener("resize",l)}var c=e.flagstone.index,v=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},m=v.elem,u=v.margin||0===v.margin?v.margin:v.bedPadding||0===v.bedPadding?v.bedPadding:10,h=0,p=v.minWidth||280,L=v.maxColumns||5,S=0,y=0,E=[],b=v.margin||0===v.margin?v.margin:v.stonesMargin||0===v.stonesMargin?v.stonesMargin:10,x=h/y-b*(y+1)/y,w=[],M=v.direction?v.direction.toLowerCase():"left",D=v.random,C=v.spaceFrequency||.4,T=v.space,P=v.animationDuration||0,z=v.animationDuration?v.animationDuration/1e3:0,B=v.animationTimingFunction||"linear",O=v.resizeDelay||0===v.resizeDelay?v.resizeDelay:250,_=v.square,A=v.imagesLoadedQueryDuration||2500,N=v.imagesLoadedQueryFrequency||100,X=v.dragAndDrop,k=v.custom||function(){},q=null,F={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,dragStart:function(){F.dragStone=this,F.dragStone.classList.add("flagstone-drag")},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==F.dragStone&&this.hasAttribute("draggable")?(F.targetStone=this,F.targetStone.classList.add("flagstone-dragover"),F.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,F.targetStoneMouseXPercent<.5?(F.targetStone.classList.remove("flagstone-right"),F.targetStone.classList.add("flagstone-left")):(F.targetStone.classList.remove("flagstone-left"),F.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===m&&this.classList.add("flagstone-dragover")},dragEnd:function(){F.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){F.targetStone&&(m.classList.remove("flagstone-dragover"),F.targetStone.classList.remove("flagstone-dragover"),F.targetStone.classList.remove("flagstone-left"),F.targetStone.classList.remove("flagstone-right"))},drop:function(e){return e.stopPropagation(),F.dragStone===this||!this.hasAttribute("draggable")&&this!==m||(F.targetStone=this,F.targetStone===m?F.targetStone.appendChild(F.dragStone):F.targetStoneMouseXPercent<.5?F.targetStone.parentElement.insertBefore(F.dragStone,F.targetStone):F.targetStone.parentElement.insertBefore(F.dragStone,F.targetStone.nextElementSibling),F.targetStone.classList.remove("flagstone-dragover"),F.targetStone.classList.remove("flagstone-left"),F.targetStone.classList.remove("flagstone-right"),F.dragStone.classList.remove("flagstone-drag")),!1}};return function(){if(r(),!t.getElementById("flagstone-"+c+"-styles")){var n=".flagstone-"+c+"-bed{box-sizing:border-box;position:relative;min-width:"+(p+2*b)+"px;}",a="",s=".flagstone-"+c+"-bed.flagstone-"+c+"-bed-hidden{visibility:hidden;}",o=".flagstone-"+c+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+M+":0px;}",i=".flagstone-"+c+"-bed__stone{-webkit-transition:top "+z+"s "+B+",left "+z+"s "+B+",right "+z+"s "+B+";-moz-transition:top "+z+"s "+B+",left "+z+"s "+B+",right "+z+"s "+B+";-ms-transition:top "+z+"s "+B+",left "+z+"s "+B+",right "+z+"s "+B+";-o-transition:top "+z+"s "+B+",left "+z+"s "+B+",right "+z+"s "+B+";transition:top "+z+"s "+B+",left "+z+"s "+B+",right "+z+"s "+B+";}",d=n+a+s+o+i,v=t.createElement("style");v.type="text/css",v.id="flagstone-"+c+"-styles",v.appendChild(t.createTextNode(d)),t.head.appendChild(v)}g(),m.addEventListener("DOMSubtreeModified",g),f(),e.addEventListener("resize",l)}(),{destroy:f,hide:r,reset:l,hardReset:g}}return e.flagstone.index++,new a(n)},e.flagstone.index=-1}(window,document);