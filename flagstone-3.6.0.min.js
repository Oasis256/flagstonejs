/*
  FlagstoneJS v3.6.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=w.length;e<t;e++)Math.random()<q&&w.splice(e,0,!1)}function a(){L.style.visibility="hidden"}function o(){L.style.visibility="visible"}function s(){var t=[k],n=0,r=A.length;for(M=[];n<r;n++){if(n<k)w[n]?(w[n].style.top=E+"px",w[n].style[z]=O*n+(n?C*n+E:E)+"px",X&&(w[n].style.height=w[n].style.width),t[n]=A[n]+E,re(w[n],n),M.push([w[n]])):k>1&&(t[n]=O+E);else{var a=Math.min.apply(null,t),s=t.indexOf(a);w[n]?(w[n].style.top=a+C+"px",w[n].style[z]=O*s+(s?C*s+E:E)+"px",X&&(w[n].style.height=w[n].style.width),t[s]+=A[n]+C,re(w[n],n),M[s].push(w[n])):k>1&&(t[s]+=O+C)}T=(Math.max.apply(null,t)||A[0]+E)+E,L.style.height=T+"px"}e.setTimeout(o)}function i(t){if(w.length){y=L.offsetWidth,y<b+(E?2*E:0)&&(y=b),D=Math.floor(y/b),k=D>x?x:D,O=y/k-(C*(k-1)+2*E)/k,A=[];for(var n=0,r=w.length;n<r;n++)w[n]&&(w[n].style.width=O+"px",w[n].style.marginTop="0px"),A.push(X||!w[n]?O:w[n].offsetHeight);y===L.offsetWidth||t?s():i(!0),t||e.setTimeout(function(){i(!0)},N)}}function l(){var t=Date.now(),n=L.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,s=n.length;o<s;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+Q<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){i(!0)}))},j)}()}function g(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(B);)n=n.parentElement;L.removeChild(n),e.MutationObserver||se()}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(i,J)}function c(t){function n(){for(var t=0,n=M.length,r=0,a=0;t<n&&!g;t++)for(r=0,a=M[t].length;r<a;r++)g&&(i.push(M[t][r]),l.push(e.parseInt(M[t][r].style.marginTop,10)||0)),M[t][r]===o&&(g=!0)}function r(){for(var t=0,n=k,a=[];t<n;t++){var o=M[t][M[t].length-1],s=e.parseInt(o.style.top,10)+(e.parseInt(o.style.marginTop,10)||0)+o.offsetHeight+E;a.push(s)}var i=Math.max.apply(null,a);L.style.height=i+"px",U=e[(V?"request":"cancel")+"AnimationFrame"](r)}function a(){function t(){for(var r=o.offsetHeight+s,g=r-a,d=0;d<n;d++)i[d].style.marginTop=g+l[d]+"px";ee=e[(te?"request":"cancel")+"AnimationFrame"](t)}var n=i.length,a=e.parseInt(i[0].style.top,10)-C+l[0];te=!0,ee=e.requestAnimationFrame(t),ne=e.setTimeout(function(){te=!1,e.cancelAnimationFrame(ee)},K),V=!0,U=e.requestAnimationFrame(r),$=e.setTimeout(function(){V=!1,e.cancelAnimationFrame(U)},K)}for(var o=t;o&&!o.classList.contains(B);)o=o.parentElement;var s=e.parseInt(o.style.top,10)+(e.parseInt(o.style.marginTop,10)||0),i=[],l=[],g=!1;return n(),V=!1,e.cancelAnimationFrame(U),e.clearTimeout($),te=!1,e.cancelAnimationFrame(ee),e.clearTimeout(ne),i.length?void a():(V=!0,U=e.requestAnimationFrame(r),void($=e.setTimeout(function(){V=!1,e.cancelAnimationFrame(U)},K)))}function f(e){"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||c(e.target)}function m(){e.clearTimeout(ae),ae=e.setTimeout(i,_)}function v(){e.clearTimeout(oe),oe=e.setTimeout(se)}function u(){e.removeEventListener("resize",m),t.head.removeChild(t.getElementById("flagstone-"+S+"-styles"))}function h(e){e.margin||0===e.margin?(E=e.margin,C=e.margin):(E=e.bedPadding||E,C=e.stonesMargin||C),b=e.minWidth||b,x=e.maxColumns||x,Y=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:Y,G=e.dropCallback||G,re=e.callback||re,se()}var S=e.flagstone.index,p=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},L=p.elem,E=p.margin||0===p.margin?p.margin:p.bedPadding||0===p.bedPadding?p.bedPadding:10,y=0,T=0,b=p.minWidth||280,x=p.maxColumns||5,D=0,k=0,w=[],C=p.margin||0===p.margin?p.margin:p.stonesMargin||0===p.stonesMargin?p.stonesMargin:10,O=y/k-C*(k+1)/k,A=[],M=[],B="flagstone-"+S+"-bed__stone",F=p.flow,z=p.direction?p.direction.toLowerCase():"left",I=p.assignReverseZIndexes,P=p.random,q=p.spaceFrequency||.4,H=p.space,N=p.animationDuration||0,R=p.animationDuration?p.animationDuration/1e3:0,W=p.animationTimingFunction||"linear",_=p.resizeDelay||0===p.resizeDelay?p.resizeDelay:250,X=p.square,Q=p.imagesLoadedQueryDuration||2500,j=p.imagesLoadedQueryFrequency||100,Y=p.dragAndDrop,Z=p.dragAndDropAutoDelay,G=p.dropCallback||function(){return!0},J=p.eventResetDelay||0,K=p.eventResizeHeightDuration||0,U=null,V=!1,$=null,ee=null,te=!1,ne=null,re=p.callback||function(){},ae=null,oe=null,se=null,ie={targetElem:null,dragStone:null,targetStone:null,targetStoneOverLeft:0,autoDropTimer:null,autoDrop:function(){ie.targetStone.classList.contains(B)&&(ie.targetStoneOverLeft?ie.dragStone!==ie.targetStone.previousElementSibling&&(ie.targetStone.parentElement.insertBefore(ie.dragStone,ie.targetStone),ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.remove("flagstone-dragover")):ie.dragStone!==ie.targetStone.nextElementSibling&&(ie.targetStone.parentElement.insertBefore(ie.dragStone,ie.targetStone.nextElementSibling),ie.targetStone.classList.remove("flagstone-right"),ie.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout(ie.autoDropTimer),ie.autoDropTimer=e.setTimeout(ie.autoDrop,Z))},clear:function(){ie.dragStone&&(ie.dragStone.classList.remove("flagstone-drag"),ie.dragStone=null),ie.targetStone&&(ie.targetStoneOverLeft=0,ie.targetStone.classList.remove("flagstone-dragover"),ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.remove("flagstone-right"),ie.targetStone=null),L.classList.remove("flagstone-dragover")},getTargetElem:function(e){for(ie.targetElem=e.target instanceof HTMLElement?e.target:e.target.parentElement;ie.targetElem&&!ie.targetElem.classList.contains("flagstone-drag-handle");)ie.targetElem=ie.targetElem.parentElement;if(ie.targetElem)for(ie.dragStone=ie.targetElem;ie.dragStone&&!ie.dragStone.classList.contains(B);)ie.dragStone=ie.dragStone.parentElement},mousedown:function(e){ie.getTargetElem(e)},dragStart:function(e){return!!ie.targetElem&&(ie.dragStone.classList.add("flagstone-drag"),void(e.dataTransfer&&e.dataTransfer.setData("text",this.id)))},touchStart:function(e){ie.getTargetElem(e),ie.dragStart(e)},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==ie.dragStone&&this!==ie.targetStone&&this!==L&&(e.clearTimeout(ie.autoDropTimer),ie.autoDropTimer=e.setTimeout(ie.autoDrop,Z))},touchMove:function(e){if(!ie.dragStone)return!1;e.preventDefault(),e.stopPropagation();for(var n=t.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),r=n;r&&!r.classList.contains(B);)r=r.parentElement;r?(L.classList.remove("flagstone-dragover"),ie.targetStoneOverLeft=r.getBoundingClientRect().left+r.offsetWidth/2>e.touches[0].clientX,ie.targetStone&&ie.targetStone!==r&&(ie.targetStone.classList.remove("flagstone-dragover"),ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.remove("flagstone-right")),ie.targetStone=r,ie.targetStone.classList.contains("flagstone-lock")||(ie.targetStone.classList.add("flagstone-dragover"),ie.targetStoneOverLeft?(ie.targetStone.classList.remove("flagstone-right"),ie.targetStone.classList.add("flagstone-left")):(ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.add("flagstone-right")))):n===L&&(ie.targetStone.classList.remove("flagstone-dragover"),ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.remove("flagstone-right"),L.classList.add("flagstone-dragover"),ie.targetStone=L)},dragOver:function(e){return!!ie.dragStone&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",void(this!==ie.dragStone&&this.classList.contains(B)?(ie.targetStone=this,ie.targetStone.classList.add("flagstone-dragover"),ie.targetStoneOverLeft=this.getBoundingClientRect().left+this.offsetWidth/2>e.clientX,ie.targetStoneOverLeft?(ie.targetStone.classList.remove("flagstone-right"),ie.targetStone.classList.add("flagstone-left")):(ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover"),ie.targetStone!==L&&L.classList.remove("flagstone-dragover")):this===L&&this.classList.add("flagstone-dragover")))},dragEnd:function(){ie.clear()},touchEnd:function(){ie.dragStone&&ie.targetStone&&!ie.targetStone.classList.contains("flagstone-lock")&&G(ie.dropStone,ie.targetStone)&&(ie.targetStone===L?L.appendChild(ie.dragStone):ie.targetStoneOverLeft?L.insertBefore(ie.dragStone,ie.targetStone):L.insertBefore(ie.dragStone,ie.targetStone.nextElementSibling)),ie.clear()},dragLeave:function(){ie.targetStone&&(ie.targetStone.classList.remove("flagstone-dragover"),ie.targetStone.classList.remove("flagstone-left"),ie.targetStone.classList.remove("flagstone-right"),L.classList.remove("flagstone-dragover"))},drop:function(t){if(!ie.dragStone)return!1;if(t.stopPropagation(),e.clearTimeout(ie.autoDropTimer),ie.dragStone!==this&&(this.classList.contains(B)||this===L)){if(ie.targetStone=this,ie.targetStone===L){if(!G(ie.dragStone,ie.targetStone))return ie.clear(),!1;ie.targetStone.appendChild(ie.dragStone)}else if(ie.targetStoneOverLeft){if(!G(ie.dragStone,ie.targetStone))return ie.clear(),!1;ie.targetStone.parentElement.insertBefore(ie.dragStone,ie.targetStone)}else{if(!G(ie.dragStone,ie.targetStone.nextElementSibling))return ie.clear(),!1;ie.targetStone.parentElement.insertBefore(ie.dragStone,ie.targetStone.nextElementSibling)}ie.clear(),e.MutationObserver||se()}return!1}};return se=function(){w=Array.prototype.slice.call(L.children);for(var t=0,n=w.length;t<n;t++)w[t].classList.add(B),I&&(w[t].style.zIndex=n-t);for(t=0;t<n;t++)w[t].setAttribute("draggable","false"),w[t].removeEventListener("mousedown",ie.mousedown),w[t].removeEventListener("dragstart",ie.dragStart),w[t].removeEventListener("touchstart",ie.touchStart),w[t].removeEventListener("touchmove",ie.touchMove),w[t].removeEventListener("dragover",ie.dragOver),w[t].removeEventListener("dragleave",ie.dragLeave),w[t].removeEventListener("dragend",ie.dragEnd),w[t].removeEventListener("touchend",ie.touchEnd),w[t].removeEventListener("drop",ie.drop),w[t].removeEventListener("touchend",ie.drop),w[t].removeEventListener("dragenter",ie.dragEnter),L.removeEventListener("dragover",ie.dragOver),L.removeEventListener("drop",ie.drop);if(Y)for(t=0;t<n;t++)w[t].classList.contains("flagstone-lock")||(w[t].setAttribute("draggable","true"),w[t].addEventListener("mousedown",ie.mousedown),w[t].addEventListener("dragstart",ie.dragStart),w[t].addEventListener("touchstart",ie.touchStart),w[t].addEventListener("touchmove",ie.touchMove),w[t].addEventListener("dragover",ie.dragOver),w[t].addEventListener("dragleave",ie.dragLeave),w[t].addEventListener("dragend",ie.dragEnd),w[t].addEventListener("touchend",ie.touchEnd),w[t].addEventListener("drop",ie.drop),w[t].addEventListener("touchend",ie.drop),Z&&w[t].addEventListener("dragenter",ie.dragEnter),L.addEventListener("dragover",ie.dragOver),L.addEventListener("drop",ie.drop));(P||H)&&(P&&w.sort(function(){return.5-Math.random()}),H&&r());var a=L.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=L.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=L.getElementsByClassName("flagstone-resize-height"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",f),a[t].addEventListener("click",f),a[t].removeEventListener("keydown",f),a[t].addEventListener("keydown",f);i(),N&&e.setTimeout(l,N),e.setTimeout(function(){i(!0)},N)},function(){if(a(),L.classList.add("flagstone-"+S+"-bed"),!t.getElementById("flagstone-"+S+"-styles")){var n=".flagstone-"+S+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(b+2*E)+"px;}",r=".flagstone-"+S+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+z+":0px;margin:0;}",o=".flagstone-"+S+"-bed__stone{transition:top "+R+"s "+W+","+z+" "+R+"s "+W+(F?",width "+R+"s "+W:"")+";}",s=n+r+o,i=t.createElement("style");i.type="text/css",i.id="flagstone-"+S+"-styles",i.appendChild(t.createTextNode(s)),t.head.appendChild(i)}if(se(),e.removeEventListener("resize",m),e.addEventListener("resize",m),e.MutationObserver){var l=new MutationObserver(v);l.observe(L,{childList:!0})}}(),{adjust:h,destroy:u,resizeHeight:c,hide:a,reset:m,hardReset:se}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);