/*
  FlagstoneJS v3.0.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function a(n){function a(){for(var e=0,t=x.length;e<t;e++)Math.random()<T&&x.splice(e,0,!1)}function r(){h.classList.add("flagstone-"+m+"-bed-hidden")}function s(){for(var t=[b],n=0,a=C.length;n<a;n++){if(n<b)if(x[n]){var r=x[n].style.width.toString().replace(/(\d+).+/,"$1");x[n].style.width=r+"px",x[n].style.top=p+"px",x[n].style[D]=k*n+(n?w*n+p:p)+"px",x[n].style.height=_?r+"px":"auto",t[n]=C[n]+p,F(x[n],n)}else b>1&&(t[n]=k+p);else{var s=Math.min.apply(null,t),o=t.indexOf(s);if(x[n]){var i=x[n].style.width.toString().replace(/(\d+).+/,"$1");x[n].style.width=i+"px",x[n].style.top=s+w+"px",x[n].style[D]=k*o+(o?w*o+p:p)+"px",x[n].style.height=_?i+"px":"auto",t[o]+=C[n]+w,F(x[n],n)}else b>1&&(t[o]+=k+w)}h.style.height=(Math.max.apply(null,t)||C[0]+p)+p+"px"}e.setTimeout(function(){h.classList.remove("flagstone-"+m+"-bed-hidden")})}function o(e){if(x.length){L=h.getBoundingClientRect().width,L<y+(p?2*p:0)&&(L=y),E=Math.floor(L/y),b=E>S?S:E,k=L/b-(w*(b-1)+2*p)/b,C=[];for(var t=0,n=x.length;t<n;t++)x[t]&&(x[t].style.width=k+"px"),C.push(_||!x[t]?k:x[t].offsetHeight);L===h.getBoundingClientRect().width||e?s():o(!0)}}function i(){var t=Date.now(),n=h.getElementsByTagName("img");n.length&&!function(){var a=e.setInterval(function(){for(var r=[],s=0,i=n.length;s<i;s++)r[s]=n[s].naturalHeight;(r.indexOf(0)===-1||t+q<Date.now())&&(e.clearInterval(a),e.setTimeout(function(){o(!0)}))},N)}()}function d(e){if("keydown"!==e.type||13===e.keyCode||32===e.keyCode){for(var t=e.target,n="flagstone-"+m+"-bed__stone";t&&!t.classList.contains(n);)t=t.parentElement;t&&t.classList.contains(n)&&h.removeChild(t)}}function g(e){"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||setTimeout(o,R)}function l(){r(),x=Array.prototype.slice.call(h.children);for(var t=0,n=x.length;t<n;t++)x[t].classList.add("flagstone-"+m+"-bed__stone");for(t=0;t<n;t++)x[t].setAttribute("draggable","false"),x[t].removeEventListener("dragstart",W.dragStart),x[t].removeEventListener("dragover",W.dragOver),x[t].removeEventListener("dragleave",W.dragLeave),x[t].removeEventListener("dragend",W.dragEnd),x[t].removeEventListener("drop",W.drop),h.removeEventListener("dragover",W.dragOver),h.removeEventListener("drop",W.drop);if(X)for(t=0;t<n;t++)x[t].setAttribute("draggable","true"),x[t].addEventListener("dragstart",W.dragStart),x[t].addEventListener("dragover",W.dragOver),x[t].addEventListener("dragleave",W.dragLeave),x[t].addEventListener("dragend",W.dragEnd),x[t].addEventListener("drop",W.drop),h.addEventListener("dragover",W.dragOver),h.addEventListener("drop",W.drop);(M||P)&&(M&&x.sort(function(){return.5-Math.random()}),P&&a());var s=h.getElementsByClassName("flagstone-remove");for(t=0,n=s.length;t<n;t++)s[t].removeEventListener("click",d),s[t].addEventListener("click",d),s[t].removeEventListener("keydown",d),s[t].addEventListener("keydown",d);for(s=h.getElementsByClassName("flagstone-reset"),t=0,n=s.length;t<n;t++)s[t].removeEventListener("click",g),s[t].addEventListener("click",g),s[t].removeEventListener("keydown",g),s[t].addEventListener("keydown",g);o(),A&&e.setTimeout(i,A),e.setTimeout(function(){o(!0)},A)}function f(){e.clearTimeout(I),I=e.setTimeout(o,O)}function v(){e.removeEventListener("resize",f)}function c(e){e.margin||0===e.margin?(p=e.margin,w=e.margin):(p=e.bedPadding||p,w=e.stonesMargin||w),y=e.minWidth||y,S=e.maxColumns||S,_=e.square===!0||e.square===!1?e.square:_,X=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:X,F=e.callback||F,l()}var m=e.flagstone.index,u=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},h=u.elem,p=u.margin||0===u.margin?u.margin:u.bedPadding||0===u.bedPadding?u.bedPadding:10,L=0,y=u.minWidth||280,S=u.maxColumns||5,E=0,b=0,x=[],w=u.margin||0===u.margin?u.margin:u.stonesMargin||0===u.stonesMargin?u.stonesMargin:10,k=L/b-w*(b+1)/b,C=[],D=u.direction?u.direction.toLowerCase():"left",M=u.random,T=u.spaceFrequency||.4,P=u.space,A=u.animationDuration||0,B=u.animationDuration?u.animationDuration/1e3:0,z=u.animationTimingFunction||"linear",O=u.resizeDelay||0===u.resizeDelay?u.resizeDelay:250,_=u.square,q=u.imagesLoadedQueryDuration||2500,N=u.imagesLoadedQueryFrequency||100,X=u.dragAndDrop,R=u.eventResetDelay||0,F=u.callback||function(){},I=null,W={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,dragStart:function(){W.dragStone=this,W.dragStone.classList.add("flagstone-drag")},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==W.dragStone&&this.hasAttribute("draggable")?(W.targetStone=this,W.targetStone.classList.add("flagstone-dragover"),W.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,W.targetStoneMouseXPercent<.5?(W.targetStone.classList.remove("flagstone-right"),W.targetStone.classList.add("flagstone-left")):(W.targetStone.classList.remove("flagstone-left"),W.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===h&&this.classList.add("flagstone-dragover")},dragEnd:function(){W.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){W.targetStone&&(h.classList.remove("flagstone-dragover"),W.targetStone.classList.remove("flagstone-dragover"),W.targetStone.classList.remove("flagstone-left"),W.targetStone.classList.remove("flagstone-right"))},drop:function(e){return e.stopPropagation(),W.dragStone===this||!this.hasAttribute("draggable")&&this!==h||(W.targetStone=this,W.targetStone===h?W.targetStone.appendChild(W.dragStone):W.targetStoneMouseXPercent<.5?W.targetStone.parentElement.insertBefore(W.dragStone,W.targetStone):W.targetStone.parentElement.insertBefore(W.dragStone,W.targetStone.nextElementSibling),W.targetStone.classList.remove("flagstone-dragover"),W.targetStone.classList.remove("flagstone-left"),W.targetStone.classList.remove("flagstone-right"),W.dragStone.classList.remove("flagstone-drag")),!1}};return function(){if(r(),h.classList.add("flagstone-"+m+"-bed"),!t.getElementById("flagstone-"+m+"-styles")){var n=".flagstone-"+m+"-bed{box-sizing:border-box;position:relative;min-width:"+(y+2*w)+"px;}",a="",s=".flagstone-"+m+"-bed.flagstone-"+m+"-bed-hidden{visibility:hidden;}",o=".flagstone-"+m+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+D+":0px;}",i=".flagstone-"+m+"-bed__stone{-webkit-transition:top "+B+"s "+z+",left "+B+"s "+z+",right "+B+"s "+z+";-moz-transition:top "+B+"s "+z+",left "+B+"s "+z+",right "+B+"s "+z+";-ms-transition:top "+B+"s "+z+",left "+B+"s "+z+",right "+B+"s "+z+";-o-transition:top "+B+"s "+z+",left "+B+"s "+z+",right "+B+"s "+z+";transition:top "+B+"s "+z+",left "+B+"s "+z+",right "+B+"s "+z+";}",d=n+a+s+o+i,g=t.createElement("style");g.type="text/css",g.id="flagstone-"+m+"-styles",g.appendChild(t.createTextNode(d)),t.head.appendChild(g)}l(),v(),e.addEventListener("resize",f),setTimeout(function(){h.addEventListener("DOMSubtreeModified",l)})}(),{adjust:c,destroy:v,hide:r,reset:f,hardReset:l}}return e.flagstone.index++,new a(n)},e.flagstone.index=-1}(window,document);