/*
  FlagstoneJS v3.3.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=x.length;e<t;e++)Math.random()<O&&x.splice(e,0,!1)}function a(){L.style.visibility="hidden"}function o(){var t=[w],n=0,r=C.length;for(M=[];n<r;n++){if(n<w)x[n]?(x[n].style.top=y+"px",x[n].style[P]=k*n+(n?D*n+y:y)+"px",q&&(x[n].style.height=x[n].style.width),t[n]=C[n]+y,V(x[n],n),M.push([x[n]])):w>1&&(t[n]=k+y);else{var a=Math.min.apply(null,t),o=t.indexOf(a);x[n]?(x[n].style.top=a+D+"px",x[n].style[P]=k*o+(o?D*o+y:y)+"px",q&&(x[n].style.height=x[n].style.width),t[o]+=C[n]+D,V(x[n],n),M[o].push(x[n])):w>1&&(t[o]+=k+D)}L.style.height=(Math.max.apply(null,t)||C[0]+y)+y+"px"}e.setTimeout(function(){L.style.visibility="visible"})}function i(t){if(x.length){S=L.getBoundingClientRect().width,S<E+(y?2*y:0)&&(S=E),T=Math.floor(S/E),w=T>b?b:T,k=S/w-(D*(w-1)+2*y)/w,C=[];for(var n=0,r=x.length;n<r;n++)x[n]&&(x[n].style.width=k+"px",x[n].style.marginTop="0px"),C.push(q||!x[n]?k:x[n].offsetHeight);S===L.getBoundingClientRect().width||t?o():i(!0),B&&(t||e.setTimeout(function(){i(!0)},N))}}function s(){var t=Date.now(),n=L.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,s=n.length;o<s;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+I<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){i(!0)}))},W)}()}function g(e){if("keydown"!==e.type||13===e.keyCode||32===e.keyCode){for(var t=e.target;t&&!t.classList.contains(A);)t=t.parentElement;L.removeChild(t)}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(i,j)}function l(t){function n(){o=r.getBoundingClientRect().height;var t=o-a;for(g=0;g<l;g++)i[g].style.marginTop=e.parseFloat(i[g].style.marginTop)+t+"px";a=o,J=e[(K?"request":"cancel")+"AnimationFrame"](n)}if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var r=t.target;r&&!r.classList.contains(A);)r=r.parentElement;for(var a=r.getBoundingClientRect().height,o=0,i=[],s=!1,g=0,d=0,l=M.length,m=0;g<l&&!s;g++)for(d=0,m=M[g].length;d<m;d++)s&&i.push(M[g][d]),M[g][d]===r&&(s=!0);l=i.length,K=!1,e.cancelAnimationFrame(J),e.clearTimeout(U),K=!0,J=e.requestAnimationFrame(n),U=e.setTimeout(function(){K=!1,e.cancelAnimationFrame(J)},G)}}function m(){x=Array.prototype.slice.call(L.children);for(var t=0,n=x.length;t<n;t++)x[t].classList.add(A);for(t=0;t<n;t++)x[t].setAttribute("draggable","false"),x[t].removeEventListener("dragstart",$.dragStart),x[t].removeEventListener("dragover",$.dragOver),x[t].removeEventListener("dragleave",$.dragLeave),x[t].removeEventListener("dragend",$.dragEnd),x[t].removeEventListener("drop",$.drop),x[t].removeEventListener("dragenter",$.dragEnter),L.removeEventListener("dragover",$.dragOver),L.removeEventListener("drop",$.drop);if(H)for(t=0;t<n;t++)x[t].setAttribute("draggable","true"),x[t].addEventListener("dragstart",$.dragStart),x[t].addEventListener("dragover",$.dragOver),x[t].addEventListener("dragleave",$.dragLeave),x[t].addEventListener("dragend",$.dragEnd),x[t].addEventListener("drop",$.drop),Q&&x[t].addEventListener("dragenter",$.dragEnter),L.addEventListener("dragover",$.dragOver),L.addEventListener("drop",$.drop);(z||F)&&(z&&x.sort(function(){return.5-Math.random()}),F&&r());var a=L.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=L.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=L.getElementsByClassName("flagstone-resize"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",l),a[t].addEventListener("click",l),a[t].removeEventListener("keydown",l),a[t].addEventListener("keydown",l);i(),N&&e.setTimeout(s,N),e.setTimeout(function(){i(!0)},N)}function f(){e.clearTimeout(Y),Y=e.setTimeout(i,_)}function v(){a(),e.clearTimeout(Z),Z=e.setTimeout(m)}function c(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+h+"-styles"))}function u(e){e.margin||0===e.margin?(y=e.margin,D=e.margin):(y=e.bedPadding||y,D=e.stonesMargin||D),E=e.minWidth||E,b=e.maxColumns||b,H=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:H,V=e.callback||V,m()}var h=e.flagstone.index,p=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},L=p.elem,y=p.margin||0===p.margin?p.margin:p.bedPadding||0===p.bedPadding?p.bedPadding:10,S=0,E=p.minWidth||280,b=p.maxColumns||5,T=0,w=0,x=[],D=p.margin||0===p.margin?p.margin:p.stonesMargin||0===p.stonesMargin?p.stonesMargin:10,k=S/w-D*(w+1)/w,C=[],M=[],A="flagstone-"+h+"-bed__stone",B=p.flow,P=p.direction?p.direction.toLowerCase():"left",z=p.random,O=p.spaceFrequency||.4,F=p.space,N=p.animationDuration||0,R=p.animationDuration?p.animationDuration/1e3:0,X=p.animationTimingFunction||"linear",_=p.resizeDelay||0===p.resizeDelay?p.resizeDelay:250,q=p.square,I=p.imagesLoadedQueryDuration||2500,W=p.imagesLoadedQueryFrequency||100,H=p.dragAndDrop,Q=p.dragAndDropAutoDelay,j=p.eventResetDelay||0,G=p.eventResizeDuration||0,J=null,K=!1,U=null,V=p.callback||function(){},Y=null,Z=null,$={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,autoDropTimer:null,autoDrop:function(){$.targetStone.classList.contains(A)&&($.targetStoneMouseXPercent<.5?$.dragStone!==$.targetStone.previousElementSibling&&($.targetStone.parentElement.insertBefore($.dragStone,$.targetStone),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-dragover")):$.dragStone!==$.targetStone.nextElementSibling&&($.targetStone.parentElement.insertBefore($.dragStone,$.targetStone.nextElementSibling),$.targetStone.classList.remove("flagstone-right"),$.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout($.autoDropTimer),$.autoDropTimer=e.setTimeout($.autoDrop,Q))},dragStart:function(e){e.dataTransfer.setData("text",this.id),$.dragStone=this,$.dragStone.classList.add("flagstone-drag")},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==$.dragStone&&this!==$.targetStone&&this!==L&&(e.clearTimeout($.autoDropTimer),$.autoDropTimer=e.setTimeout($.autoDrop,Q))},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==$.dragStone&&this.hasAttribute("draggable")?($.targetStone=this,$.targetStone.classList.add("flagstone-dragover"),$.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,$.targetStoneMouseXPercent<.5?($.targetStone.classList.remove("flagstone-right"),$.targetStone.classList.add("flagstone-left")):($.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===L&&this.classList.add("flagstone-dragover")},dragEnd:function(){$.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){$.targetStone&&(L.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-right"))},drop:function(t){return t.stopPropagation(),e.clearTimeout($.autoDropTimer),$.dragStone===this||!this.hasAttribute("draggable")&&this!==L||($.targetStone=this,$.targetStone===L?$.targetStone.appendChild($.dragStone):$.targetStoneMouseXPercent<.5?$.targetStone.parentElement.insertBefore($.dragStone,$.targetStone):$.targetStone.parentElement.insertBefore($.dragStone,$.targetStone.nextElementSibling),$.targetStone.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-right"),$.dragStone.classList.remove("flagstone-drag")),!1}};return function(){if(L.classList.add("flagstone-"+h+"-bed"),!t.getElementById("flagstone-"+h+"-styles")){var n=".flagstone-"+h+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;margin:0;padding:0;min-width:"+(E+2*D)+"px;}",r=".flagstone-"+h+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+P+":0px;margin:0;}",a=".flagstone-"+h+"-bed__stone{-webkit-transition:top "+R+"s "+X+", left "+R+"s "+X+", right "+R+"s "+X+(B?", width "+R+"s "+X:"")+";-moz-transition:top "+R+"s "+X+", left "+R+"s "+X+", right "+R+"s "+X+(B?", width "+R+"s "+X:"")+";-ms-transition:top "+R+"s "+X+", left "+R+"s "+X+", right "+R+"s "+X+(B?", width "+R+"s "+X:"")+";-o-transition:top "+R+"s "+X+", left "+R+"s "+X+", right "+R+"s "+X+(B?", width "+R+"s "+X:"")+";transition:top "+R+"s "+X+", left "+R+"s "+X+", right "+R+"s "+X+(B?", width "+R+"s "+X:"")+";}",o=n+r+a,i=t.createElement("style");i.type="text/css",i.id="flagstone-"+h+"-styles",i.appendChild(t.createTextNode(o)),t.head.appendChild(i)}if(m(),e.removeEventListener("resize",f),e.addEventListener("resize",f),e.MutationObserver){var s=new MutationObserver(v);s.observe(L,{childList:!0})}}(),{adjust:u,destroy:c,hide:a,reset:f,hardReset:m}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);