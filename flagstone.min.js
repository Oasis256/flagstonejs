/*
 Copyright 2014 by CLEARWAVE DESIGNS, LLC.
 
 Licensed under the Apache License, Version 2.0
 http://www.apache.org/licenses/LICENSE-2.0
 
 Author:        Adam Carson
 Website:       http://clearwavedesigns.com
 Dependencies:  jquery.js (1.8.3+)
 
 Name(s):       FlagstoneJS (jQuery dependent)
 Slogan:        "Responsive tiling."
 Description:   Responsively tiles HTML elements left to right, top to bottom, and where there's the most room.
*/

var FLAGSTONE=function(t){var i=this,s=t||{};this.areaStr=s.area||"[flagstones]",this.area=$(this.areaStr),this.areaWidth=this.area.outerWidth(),this.areaHeight=this.area.outerHeight(),this.minWidth=s.minWidth||280,this.columns=Math.floor(this.areaWidth/this.minWidth),this.margin=s.margin||10,this.flagstonesStr=s.flagstones||"[flagstone]",this.flagstones=$(this.flagstonesStr),this.flagstoneHeights=[],this.flagstoneWidth=this.areaWidth/this.columns-this.margin*(this.columns+1)/this.columns,this.duration=s.duration/1e3||1,this.init=function(){$("head").append("<style>"+this.areaStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}"+this.flagstonesStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0px;left:0px;-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}</style>"),this.flagstones.each(function(){var t=$(this);t.css("width",i.flagstoneWidth+"px"),i.flagstoneHeights.push(t.outerHeight())})},this.init(),this.run=function(){for(var t=new Array(this.columns),i=0,s=this.flagstoneHeights.length;s>i;i++){if(i>=this.columns){var n=Math.min.apply(null,t),a=t.indexOf(n);this.flagstones.eq(i).css({top:n+this.margin+"px",left:this.flagstoneWidth*a+this.margin*(a+1)+"px"}),t[a]+=this.flagstoneHeights[i]+this.margin}else for(var e=0,o=this.columns;o>e;e++)this.flagstones.eq(e).css({top:this.margin+"px",left:this.flagstoneWidth*e+this.margin*(e+1)+"px"}),t[e]=this.flagstoneHeights[e]+this.margin;this.area.css("height",Math.max.apply(null,t)+this.margin+"px")}},this.run(),this.area.find("img,iframe,video,audio,object,embed").on("load",function(){i.reset()}),this.resetDelay1,this.resetDelay2,this.reset=function(){for(i.areaWidth=i.area.outerWidth(),i.columns=Math.floor(i.areaWidth/i.minWidth),i.flagstoneWidth=i.areaWidth/i.columns-i.margin*(i.columns+1)/i.columns;i.flagstoneHeights.length>0;)i.flagstoneHeights.pop();i.flagstones.each(function(){var t=$(this);t.css("width",i.flagstoneWidth+"px"),i.flagstoneHeights.push(t.outerHeight())}),i.run()},$(window).on("resize",function(){clearTimeout(i.resetDelay1),clearTimeout(i.resetDelay2),i.resetDelay1=setTimeout(i.reset,100),i.resetDelay2=setTimeout(i.reset,i.duration+1100)}),this.hardReset=function(){i.flagstones=$(i.flagstonesStr),i.flagstones.each(function(){var t=$(this);t.css("width",i.flagstoneWidth+"px")}),i.reset()}};
