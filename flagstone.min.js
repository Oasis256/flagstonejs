/*
 Copyright 2014-2015 by CLEARWAVE DESIGNS, LLC.
 
 Licensed under the Apache License, Version 2.0
 http://www.apache.org/licenses/LICENSE-2.0
 
 Author:        Adam Carson
 Website:       http://clearwavedesigns.com
 Dependencies:  jquery.js (1.8.3+)
 
 Name(s):       FlagstoneJS (flagstone.js)
 Version:       1.2.20150720
 Slogan:        "Responsive tiling."
 Description:   Responsively tiles HTML elements left to right, top to bottom, and where there's the most room.
 */

var FLAGSTONE=function(i){var t=this,a=i||{};this.areaStr=a.area||"[flagstones]",this.area=$(this.areaStr),this.areaMargin=a.margin||0===a.margin?a.margin:a.areaMargin||0===a.areaMargin?a.areaMargin:10,this.areaWidth=this.area.outerWidth(),this.areaHeight=this.area.outerHeight(),this.minWidth=a.minWidth||280,this.maxColumns=a.maxColumns||1920,this.calcColumns=Math.floor(this.areaWidth/this.minWidth),this.columns=this.calcColumns>this.maxColumns?this.maxColumns:this.calcColumns,this.margin=a.margin||0===a.margin?a.margin:10,this.flagstonesStr=a.flagstones||"[flagstone]",this.flagstones=$(this.flagstonesStr),this.flagstonesMargin=a.margin||0===a.margin?a.margin:a.flagstonesMargin||0===a.flagstonesMargin?a.flagstonesMargin:10,this.flagstoneHeights=[],this.flagstoneWidth=this.areaWidth/this.columns-this.margin*(this.columns+1)/this.columns,this.direction=a.direction?a.direction.toLowerCase():"left",this.duration=a.duration/1e3||0,this.jqueryAnimation=a.jqueryAnimation,this.resizeDelay=a.resizeDelay||0,this.hide=function(){this.area.addClass("flagstones-hidden")},this.run=function(){for(var i=new Array(this.columns),a=0,s=this.flagstoneHeights.length;s>a;a++){if(a<this.columns)for(var e=0,n=this.columns;n>e;e++)this.jqueryAnimation?this.flagstones.eq(e).animate({top:this.areaMargin+"px",left:"right"===this.direction?"auto":this.flagstoneWidth*e+(e?this.flagstonesMargin*e+this.areaMargin:this.areaMargin)+"px",right:"left"===this.direction?"auto":this.flagstoneWidth*e+(e?this.flagstonesMargin*e+this.areaMargin:this.areaMargin)+"px"},1e3*this.duration):this.flagstones.eq(e).css({top:this.areaMargin+"px",left:"right"===this.direction?"auto":this.flagstoneWidth*e+(e?this.flagstonesMargin*e+this.areaMargin:this.areaMargin)+"px",right:"left"===this.direction?"auto":this.flagstoneWidth*e+(e?this.flagstonesMargin*e+this.areaMargin:this.areaMargin)+"px"}),i[e]=this.flagstoneHeights[e]+this.areaMargin;else{var r=Math.min.apply(null,i),o=i.indexOf(r);this.jqueryAnimation?this.flagstones.eq(a).animate({top:r+this.flagstonesMargin+"px",left:"right"===this.direction?"auto":this.flagstoneWidth*o+(o?this.flagstonesMargin*o+this.areaMargin:this.areaMargin)+"px",right:"left"===this.direction?"auto":this.flagstoneWidth*o+(o?this.flagstonesMargin*o+this.areaMargin:this.areaMargin)+"px"},1e3*this.duration):this.flagstones.eq(a).css({top:r+this.flagstonesMargin+"px",left:"right"===this.direction?"auto":this.flagstoneWidth*o+(o?this.flagstonesMargin*o+this.areaMargin:this.areaMargin)+"px",right:"left"===this.direction?"auto":this.flagstoneWidth*o+(o?this.flagstonesMargin*o+this.areaMargin:this.areaMargin)+"px"}),i[o]+=this.flagstoneHeights[a]+this.flagstonesMargin}this.area.css("height",(Math.max.apply(null,i)||this.flagstoneHeights[0]+this.areaMargin)+this.areaMargin+"px")}setTimeout(function(){t.area.removeClass("flagstones-hidden")},0)},this.resetDelay1,this.resetDelay2,this.resetDelay3,this.reset=function(){for(t.areaWidth=t.area.outerWidth(),t.areaWidth<t.minWidth+(this.areaMargin?2*t.areaMargin:0)&&(t.areaWidth=t.minWidth),t.calcColumns=Math.floor(t.areaWidth/t.minWidth),t.columns=t.calcColumns>t.maxColumns?t.maxColumns:t.calcColumns,t.flagstoneWidth=t.areaWidth/t.columns-(t.flagstonesMargin*(t.columns-1)+2*t.areaMargin)/t.columns;t.flagstoneHeights.length>0;)t.flagstoneHeights.pop();t.flagstones.each(function(){var i=$(this);t.jqueryAnimation?i.animate({width:t.flagstoneWidth+"px"},1e3*t.duration):i.css("width",t.flagstoneWidth+"px"),t.flagstoneHeights.push(i.outerHeight())}),t.run()},this.hardReset=function(){t.hide(),setTimeout(function(){t.flagstones=$(t.flagstonesStr),t.reset()},0)},this.init=function(){this.hide();var i=$("head");i.append("<style>"+this.areaStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;min-width:"+(this.minWidth+2*this.margin)+"px;}"+this.flagstonesStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0px;"+this.direction+":0px;}"+this.areaStr+".flagstones-hidden{visibility:hidden;}</style>"),this.jqueryAnimation||i.append("<style>"+this.areaStr+"{-webkit-transition-duration:"+t.duration+"s;-moz-transition-duration:"+t.duration+"s;-ms-transition-duration:"+t.duration+"s;-o-transition-duration:"+t.duration+"s;transition-duration:"+t.duration+"s;}"+this.flagstonesStr+"{-webkit-transition-duration:"+t.duration+"s;-moz-transition-duration:"+t.duration+"s;-ms-transition-duration:"+t.duration+"s;-o-transition-duration:"+t.duration+"s;transition-duration:"+t.duration+"s;}</style>"),$(window).on("resize",function(){clearTimeout(t.resetDelay1),clearTimeout(t.resetDelay2),clearTimeout(t.resetDelay3),t.resetDelay1=setTimeout(t.reset.bind(t),t.resizeDelay),t.resetDelay2=setTimeout(t.reset.bind(t),t.duration+t.resizeDelay+1e3),t.resetDelay3=setTimeout(t.reset.bind(t),t.duration+t.resizeDelay+2e3)}),setTimeout(this.reset.bind(this),0),setTimeout(function(){t.area.find("img,iframe,video,audio,oect,embed").on("load",function(){t.reset()})},0)},this.init()};
