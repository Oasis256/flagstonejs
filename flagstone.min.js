/*
 Copyright 2014 by CLEARWAVE DESIGNS, LLC.
 
 Licensed under the Apache License, Version 2.0
 http://www.apache.org/licenses/LICENSE-2.0
 
 Author:        Adam Carson
 Website:       http://clearwavedesigns.com
 Dependencies:  jquery.js (1.8.3+)
 
 Name(s):       FlagstoneJS (flagstone.js)
 Slogan:        "Responsive tiling."
 Description:   Responsively tiles HTML elements left to right, top to bottom, and where there's the most room.
*/

var FLAGSTONE=function(t){var i=this,s=t||{};this.areaStr=s.area||"[flagstones]",this.area=$(this.areaStr),this.areaWidth=this.area.outerWidth(),this.areaHeight=this.area.outerHeight(),this.minWidth=s.minWidth||280,this.maxColumns=s.maxColumns||1920,this.calcColumns=Math.floor(this.areaWidth/this.minWidth),this.columns=this.calcColumns>this.maxColumns?this.maxColumns:this.calcColumns,this.margin=s.margin||10,this.flagstonesStr=s.flagstones||"[flagstone]",this.flagstones=$(this.flagstonesStr),this.flagstoneHeights=[],this.flagstoneWidth=this.areaWidth/this.columns-this.margin*(this.columns+1)/this.columns,this.duration=s.duration/1e3||1,this.init=function(){$("head").append("<style>"+this.areaStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;min-width:"+(this.minWidth+2*this.margin)+"px;-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}"+this.flagstonesStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0px;left:0px;-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}</style>"),this.areaWidth<this.minWidth+2*this.margin&&(this.areaWidth=this.minWidth),this.flagstones.each(function(){var t=$(this);t.css("width",i.flagstoneWidth+"px"),i.flagstoneHeights.push(t.outerHeight())})},this.init(),this.run=function(){for(var t=new Array(this.columns),i=0,s=this.flagstoneHeights.length;s>i;i++){if(i>=this.columns){var a=Math.min.apply(null,t),n=t.indexOf(a);this.flagstones.eq(i).css({top:a+this.margin+"px",left:this.flagstoneWidth*n+this.margin*(n+1)+"px"}),t[n]+=this.flagstoneHeights[i]+this.margin}else for(var e=0,o=this.columns;o>e;e++)this.flagstones.eq(e).css({top:this.margin+"px",left:this.flagstoneWidth*e+this.margin*(e+1)+"px"}),t[e]=this.flagstoneHeights[e]+this.margin;this.area.css("height",(Math.max.apply(null,t)||this.flagstoneHeights[0]+this.margin)+this.margin+"px")}},this.run(),this.area.find("img,iframe,video,audio,object,embed").on("load",function(){i.reset()}),this.resetDelay1,this.resetDelay2,this.resetDelay3,this.reset=function(){for(i.areaWidth=i.area.outerWidth(),i.areaWidth<i.minWidth+2*i.margin&&(i.areaWidth=i.minWidth),i.calcColumns=Math.floor(i.areaWidth/i.minWidth),i.columns=i.calcColumns>i.maxColumns?i.maxColumns:i.calcColumns,i.flagstoneWidth=i.areaWidth/i.columns-i.margin*(i.columns+1)/i.columns;i.flagstoneHeights.length>0;)i.flagstoneHeights.pop();i.flagstones.each(function(){var t=$(this);t.css("width",i.flagstoneWidth+"px"),i.flagstoneHeights.push(t.outerHeight())}),i.run()},$(window).on("resize",function(){clearTimeout(i.resetDelay1),clearTimeout(i.resetDelay2),clearTimeout(i.resetDelay3),i.resetDelay1=setTimeout(i.reset,100),i.resetDelay2=setTimeout(i.reset,i.duration+1100),i.resetDelay2=setTimeout(i.reset,i.duration+2100)}),this.hardReset=function(){i.flagstones=$(i.flagstonesStr),i.reset()}};
