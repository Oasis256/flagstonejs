/*
 Copyright 2014-2015 by CLEARWAVE DESIGNS, LLC.
 
 Licensed under the Apache License, Version 2.0
 http://www.apache.org/licenses/LICENSE-2.0
 
 Author:        Adam Carson
 Website:       http://clearwavedesigns.com
 Dependencies:  None.
 
 Name(s):       FlagstoneJS (flagstone.js)
 Version:       1.2.20150720
 Slogan:        "Responsive tiling."
 Description:   Responsively tiles HTML elements left to right, top to bottom, and where there's the most room.
 */

var FLAGSTONE=function(t){var i=function(t){for(var i=[],s=document.querySelectorAll(t),e=0,a=s.length;a>e;e++)i[e]=s[e];return i.length>1?i:i[0]},s=this,e=t||{};this.areaStr=e.area||"[flagstones]",this.area=i(this.areaStr),this.areaMargin=e.margin||0===e.margin?e.margin:e.areaMargin||0===e.areaMargin?e.areaMargin:10,this.areaWidth=0,this.areaHeight=0,this.minWidth=e.minWidth||280,this.maxColumns=e.maxColumns||1920,this.calcColumns=0,this.columns=0,this.flagstonesStr=e.flagstones||"[flagstone]",this.flagstones=i(this.flagstonesStr),this.flagstonesMargin=e.margin||0===e.margin?e.margin:e.flagstonesMargin||0===e.flagstonesMargin?e.flagstonesMargin:10,this.flagstoneHeights=[],this.flagstoneWidth=this.areaWidth/this.columns-this.flagstonesMargin*(this.columns+1)/this.columns,this.direction=e.direction?e.direction.toLowerCase():"left",this.duration=e.duration/1e3||0,this.resizeDelay=e.resizeDelay||0===e.resizeDelay?e.resizeDelay:250,this.hide=function(){this.area.className=this.area.className+" flagstones-hidden"},this.run=function(){for(var t=[this.columns],i=0,e=this.flagstoneHeights.length;e>i;i++){if(i<this.columns)for(var a=0,n=this.columns;n>a;a++){var r="width: "+this.flagstones[a].style.cssText.replace(/.*width\:\s?(\d+).+/,"$1")+"px;";this.flagstones[a].style="",this.flagstones[a].style.cssText=r+"top: "+this.areaMargin+"px;"+this.direction+":"+(this.flagstoneWidth*a+(a?this.flagstonesMargin*a+this.areaMargin:this.areaMargin))+"px;",t[a]=this.flagstoneHeights[a]+this.areaMargin}else{var o=Math.min.apply(null,t),h=t.indexOf(o),r="width: "+this.flagstones[a].style.cssText.replace(/.*width\:\s?(\d+).+/,"$1")+"px;";this.flagstones[i].style="",this.flagstones[i].style.cssText=r+"top: "+(o+this.flagstonesMargin)+"px;"+this.direction+":"+(this.flagstoneWidth*h+(h?this.flagstonesMargin*h+this.areaMargin:this.areaMargin))+"px;",t[h]+=this.flagstoneHeights[i]+this.flagstonesMargin}this.area.style.height=(Math.max.apply(null,t)||this.flagstoneHeights[0]+this.areaMargin)+this.areaMargin+"px"}setTimeout(function(){s.area.className=s.area.className.replace(/\s?flagstones\-hidden/,"")},0)},this.resetDelay1,this.resetDelay2,this.resetDelay3,this.reset=function(){for(s.areaWidth=s.area.outerWidth||s.area.offsetWidth,s.areaWidth<s.minWidth+(this.areaMargin?2*s.areaMargin:0)&&(s.areaWidth=s.minWidth),s.calcColumns=Math.floor(s.areaWidth/s.minWidth),s.columns=s.calcColumns>s.maxColumns?s.maxColumns:s.calcColumns,s.flagstoneWidth=s.areaWidth/s.columns-(s.flagstonesMargin*(s.columns-1)+2*s.areaMargin)/s.columns;s.flagstoneHeights.length>0;)s.flagstoneHeights.pop();for(var t=0,i=s.flagstones.length;i>t;t++)s.flagstones[t].style.width=s.flagstoneWidth+"px",s.flagstoneHeights.push(s.flagstones[t].outerHeight||s.flagstones[t].offsetHeight);s.run()},this.hardReset=function(){s.hide(),setTimeout(function(){s.flagstones=i(s.flagstonesStr),s.reset()},0)},this.init=function(){this.hide();var t=this.areaStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;min-width:"+(this.minWidth+2*this.flagstonesMargin)+"px;}"+this.flagstonesStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0px;"+this.direction+":0px;}"+this.areaStr+".flagstones-hidden{visibility:hidden;}</style>"+this.areaStr+"{-webkit-transition-duration:"+s.duration+"s;-moz-transition-duration:"+s.duration+"s;-ms-transition-duration:"+s.duration+"s;-o-transition-duration:"+s.duration+"s;transition-duration:"+s.duration+"s;}"+this.flagstonesStr+"{-webkit-transition-duration:"+s.duration+"s;-moz-transition-duration:"+s.duration+"s;-ms-transition-duration:"+s.duration+"s;-o-transition-duration:"+s.duration+"s;transition-duration:"+s.duration+"s;}",e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(t)),i("head").appendChild(e),window.addEventListener("resize",function(){clearTimeout(s.resetDelay1),clearTimeout(s.resetDelay2),clearTimeout(s.resetDelay3),s.resetDelay1=setTimeout(s.reset.bind(s),s.resizeDelay),s.resetDelay2=setTimeout(s.reset.bind(s),s.duration+s.resizeDelay+1e3),s.resetDelay3=setTimeout(s.reset.bind(s),s.duration+s.resizeDelay+2e3)}),setTimeout(this.reset.bind(this),0),setTimeout(function(){window.addEventListener("load",function(){s.reset()})},0)},this.init()};
