/*
 Copyright 2014-2015 by CLEARWAVE DESIGNS, LLC.
 
 Licensed under the Apache License, Version 2.0
 http://www.apache.org/licenses/LICENSE-2.0
 
 Author:        Adam Carson
 Website:       http://clearwavedesigns.com
 Dependencies:  None.
 
 Name(s):       FlagstoneJS (flagstone.js)
 Version:       1.3.20150723
 Slogan:        "Responsive tiling."
 Description:   Responsively tiles HTML elements left to right, top to bottom, and where there's the most room.
 */

var FLAGSTONE=function(t){var s=function(t){for(var s=[],i=document.querySelectorAll(t),e=0,a=i.length;a>e;e++)s[e]=i[e];return s.length>1?s:s[0]},i=this,e=t||{};this.areaStr=e.area||"[flagstones]",this.area=s(this.areaStr),this.areaMargin=e.margin||0===e.margin?e.margin:e.areaMargin||0===e.areaMargin?e.areaMargin:10,this.areaWidth=0,this.areaHeight=0,this.minWidth=e.minWidth||280,this.maxColumns=e.maxColumns||1920,this.calcColumns=0,this.columns=0,this.flagstonesStr=e.flagstones||"[flagstone]",this.flagstones=s(this.flagstonesStr),this.flagstonesMargin=e.margin||0===e.margin?e.margin:e.flagstonesMargin||0===e.flagstonesMargin?e.flagstonesMargin:10,this.flagstoneHeights=[],this.flagstoneWidth=this.areaWidth/this.columns-this.flagstonesMargin*(this.columns+1)/this.columns,this.direction=e.direction?e.direction.toLowerCase():"left",this.duration=e.duration/1e3||0,this.resizeDelay=e.resizeDelay||0===e.resizeDelay?e.resizeDelay:250,this.hide=function(){this.area.className=this.area.className+" flagstones-hidden"},this.run=function(){for(var t=[this.columns],s=0,e=this.flagstoneHeights.length;e>s;s++){if(s<this.columns)for(var a=0,n=this.columns;n>a;a++){var r="width: "+this.flagstones[a].style.cssText.replace(/.*width\:\s?(\d+).+/,"$1")+"px;";this.flagstones[a].style="",this.flagstones[a].style.cssText=r+"top: "+this.areaMargin+"px;"+this.direction+":"+(this.flagstoneWidth*a+(a?this.flagstonesMargin*a+this.areaMargin:this.areaMargin))+"px;",t[a]=this.flagstoneHeights[a]+this.areaMargin}else{var o=Math.min.apply(null,t),h=t.indexOf(o),r="width: "+this.flagstones[a].style.cssText.replace(/.*width\:\s?(\d+).+/,"$1")+"px;";this.flagstones[s].style="",this.flagstones[s].style.cssText=r+"top: "+(o+this.flagstonesMargin)+"px;"+this.direction+":"+(this.flagstoneWidth*h+(h?this.flagstonesMargin*h+this.areaMargin:this.areaMargin))+"px;",t[h]+=this.flagstoneHeights[s]+this.flagstonesMargin}this.area.style.height=(Math.max.apply(null,t)||this.flagstoneHeights[0]+this.areaMargin)+this.areaMargin+"px"}setTimeout(function(){i.area.className=i.area.className.replace(/\s?flagstones\-hidden/,"")},0)},this.resetDelay1,this.resetDelay2,this.resetDelay3,this.reset=function(){for(i.areaWidth=i.area.outerWidth||i.area.offsetWidth,i.areaWidth<i.minWidth+(this.areaMargin?2*i.areaMargin:0)&&(i.areaWidth=i.minWidth),i.calcColumns=Math.floor(i.areaWidth/i.minWidth),i.columns=i.calcColumns>i.maxColumns?i.maxColumns:i.calcColumns,i.flagstoneWidth=i.areaWidth/i.columns-(i.flagstonesMargin*(i.columns-1)+2*i.areaMargin)/i.columns;i.flagstoneHeights.length>0;)i.flagstoneHeights.pop();for(var t=0,s=i.flagstones.length;s>t;t++)i.flagstones[t].style.width=i.flagstoneWidth+"px",i.flagstoneHeights.push(i.flagstones[t].outerHeight||i.flagstones[t].offsetHeight);i.run()},this.hardReset=function(){i.hide(),setTimeout(function(){i.flagstones=s(i.flagstonesStr),i.reset()},0)},this.resets=function(){clearTimeout(i.resetDelay1),clearTimeout(i.resetDelay2),clearTimeout(i.resetDelay3),i.resetDelay1=setTimeout(i.reset.bind(i),i.resizeDelay),i.resetDelay2=setTimeout(i.reset.bind(i),1e3*i.duration+i.resizeDelay),i.resetDelay3=setTimeout(i.reset.bind(i),2e3*i.duration+i.resizeDelay)},this.init=function(){this.hide();var t=this.areaStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:relative;min-width:"+(this.minWidth+2*this.flagstonesMargin)+"px;}"+this.flagstonesStr+"{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;position:absolute;top:0px;"+this.direction+":0px;}"+this.areaStr+".flagstones-hidden{visibility:hidden;}</style>"+this.areaStr+"{-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}"+this.flagstonesStr+"{-webkit-transition-duration:"+i.duration+"s;-moz-transition-duration:"+i.duration+"s;-ms-transition-duration:"+i.duration+"s;-o-transition-duration:"+i.duration+"s;transition-duration:"+i.duration+"s;}",e=document.createElement("style");e.type="text/css",e.appendChild(document.createTextNode(t)),s("head").appendChild(e),setTimeout(i.reset,0),setTimeout(window.addEventListener("load",i.resets),0),window.addEventListener("resize",i.resets)},this.init()};
