/*
  FlagstoneJS v3.5.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=w.length;e<t;e++)Math.random()<F&&w.splice(e,0,!1)}function a(){L.style.visibility="hidden"}function o(){var t=[x],n=0,r=C.length;for(O=[];n<r;n++){if(n<x)w[n]?(w[n].style.top=p+"px",w[n].style[A]=k*n+(n?D*n+p:p)+"px",H&&(w[n].style.height=w[n].style.width),t[n]=C[n]+p,V(w[n],n),O.push([w[n]])):x>1&&(t[n]=k+p);else{var a=Math.min.apply(null,t),o=t.indexOf(a);w[n]?(w[n].style.top=a+D+"px",w[n].style[A]=k*o+(o?D*o+p:p)+"px",H&&(w[n].style.height=w[n].style.width),t[o]+=C[n]+D,V(w[n],n),O[o].push(w[n])):x>1&&(t[o]+=k+D)}L.style.height=(Math.max.apply(null,t)||C[0]+p)+p+"px"}e.setTimeout(function(){L.style.visibility="visible"})}function s(t){if(w.length){E=L.getBoundingClientRect().width,E<y+(p?2*p:0)&&(E=y),T=Math.floor(E/y),x=T>b?b:T,k=E/x-(D*(x-1)+2*p)/x,C=[];for(var n=0,r=w.length;n<r;n++)w[n]&&(w[n].style.width=k+"px",w[n].style.marginTop="0px"),C.push(H||!w[n]?k:w[n].offsetHeight);E===L.getBoundingClientRect().width||t?o():s(!0),t||e.setTimeout(function(){s(!0)},R)}}function i(){var t=Date.now(),n=L.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,i=n.length;o<i;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+I<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){s(!0)}))},W)}()}function g(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(B);)n=n.parentElement;L.removeChild(n),e.MutationObserver||ee()}}function l(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(s,Y)}function d(t){function n(){var t=r.getBoundingClientRect().height+a;for(i=0;i<l;i++)o[i].style.marginTop=t-c+"px";J=e[(K?"request":"cancel")+"AnimationFrame"](n)}for(var r=t;r&&!r.classList.contains(B);)r=r.parentElement;for(var a=e.parseFloat(r.style.top),o=[],s=!1,i=0,g=0,l=O.length,d=0;i<l&&!s;i++)for(g=0,d=O[i].length;g<d;g++)s&&o.push(O[i][g]),O[i][g]===r&&(s=!0);if(o.length){var c=e.parseFloat(o[0].style.top)-D;l=o.length,K=!1,e.cancelAnimationFrame(J),e.clearTimeout(U),K=!0,J=e.requestAnimationFrame(n),U=e.setTimeout(function(){K=!1,e.cancelAnimationFrame(J)},G)}}function c(e){"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||d(e.target)}function f(){e.clearTimeout(Z),Z=e.setTimeout(s,q)}function v(){a(),e.clearTimeout($),$=e.setTimeout(ee)}function m(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+S+"-styles"))}function u(e){e.margin||0===e.margin?(p=e.margin,D=e.margin):(p=e.bedPadding||p,D=e.stonesMargin||D),y=e.minWidth||y,b=e.maxColumns||b,X=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:X,j=e.dropCallback||j,V=e.callback||V,ee()}var S=e.flagstone.index,h=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},L=h.elem,p=h.margin||0===h.margin?h.margin:h.bedPadding||0===h.bedPadding?h.bedPadding:10,E=0,y=h.minWidth||280,b=h.maxColumns||5,T=0,x=0,w=[],D=h.margin||0===h.margin?h.margin:h.stonesMargin||0===h.stonesMargin?h.stonesMargin:10,k=E/x-D*(x+1)/x,C=[],O=[],B="flagstone-"+S+"-bed__stone",M=h.flow,A=h.direction?h.direction.toLowerCase():"left",z=h.random,F=h.spaceFrequency||.4,P=h.space,R=h.animationDuration||0,N=h.animationDuration?h.animationDuration/1e3:0,_=h.animationTimingFunction||"linear",q=h.resizeDelay||0===h.resizeDelay?h.resizeDelay:250,H=h.square,I=h.imagesLoadedQueryDuration||2500,W=h.imagesLoadedQueryFrequency||100,X=h.dragAndDrop,Q=h.dragAndDropAutoDelay,j=h.dropCallback||function(){return!0},Y=h.eventResetDelay||0,G=h.eventResizeHeightDuration||0,J=null,K=!1,U=null,V=h.callback||function(){},Z=null,$=null,ee=null,te={targetElem:null,dragStone:null,targetStone:null,targetStoneOverLeft:0,autoDropTimer:null,autoDrop:function(){te.targetStone.classList.contains(B)&&(te.targetStoneOverLeft?te.dragStone!==te.targetStone.previousElementSibling&&(te.targetStone.parentElement.insertBefore(te.dragStone,te.targetStone),te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.remove("flagstone-dragover")):te.dragStone!==te.targetStone.nextElementSibling&&(te.targetStone.parentElement.insertBefore(te.dragStone,te.targetStone.nextElementSibling),te.targetStone.classList.remove("flagstone-right"),te.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout(te.autoDropTimer),te.autoDropTimer=e.setTimeout(te.autoDrop,Q))},clear:function(){te.dragStone&&(te.dragStone.classList.remove("flagstone-drag"),te.dragStone=null),te.targetStone&&(te.targetStoneOverLeft=0,te.targetStone.classList.remove("flagstone-dragover"),te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.remove("flagstone-right"),te.targetStone=null),L.classList.remove("flagstone-dragover")},getTargetElem:function(e){for(te.targetElem=e.target instanceof HTMLElement?e.target:e.target.parentElement;te.targetElem&&!te.targetElem.classList.contains("flagstone-drag-handle");)te.targetElem=te.targetElem.parentElement;if(te.targetElem)for(te.dragStone=te.targetElem;te.dragStone&&!te.dragStone.classList.contains(B);)te.dragStone=te.dragStone.parentElement},mousedown:function(e){te.getTargetElem(e)},dragStart:function(e){return!!te.targetElem&&(te.dragStone.classList.add("flagstone-drag"),void(e.dataTransfer&&e.dataTransfer.setData("text",this.id)))},touchStart:function(e){te.getTargetElem(e),te.dragStart(e)},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==te.dragStone&&this!==te.targetStone&&this!==L&&(e.clearTimeout(te.autoDropTimer),te.autoDropTimer=e.setTimeout(te.autoDrop,Q))},touchMove:function(e){if(!te.dragStone)return!1;e.preventDefault(),e.stopPropagation();for(var n=t.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),r=n;r&&!r.classList.contains(B);)r=r.parentElement;r?(L.classList.remove("flagstone-dragover"),te.targetStoneOverLeft=r.getBoundingClientRect().left+r.offsetWidth/2>e.touches[0].clientX,te.targetStone&&te.targetStone!==r&&(te.targetStone.classList.remove("flagstone-dragover"),te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.remove("flagstone-right")),te.targetStone=r,te.targetStone.classList.contains("flagstone-lock")||(te.targetStone.classList.add("flagstone-dragover"),te.targetStoneOverLeft?(te.targetStone.classList.remove("flagstone-right"),te.targetStone.classList.add("flagstone-left")):(te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.add("flagstone-right")))):n===L&&(te.targetStone.classList.remove("flagstone-dragover"),te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.remove("flagstone-right"),L.classList.add("flagstone-dragover"),te.targetStone=L)},dragOver:function(e){return!!te.dragStone&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",void(this!==te.dragStone&&this.classList.contains(B)?(te.targetStone=this,te.targetStone.classList.add("flagstone-dragover"),te.targetStoneOverLeft=this.getBoundingClientRect().left+this.offsetWidth/2>e.clientX,te.targetStoneOverLeft?(te.targetStone.classList.remove("flagstone-right"),te.targetStone.classList.add("flagstone-left")):(te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover"),te.targetStone!==L&&L.classList.remove("flagstone-dragover")):this===L&&this.classList.add("flagstone-dragover")))},dragEnd:function(){te.clear()},touchEnd:function(){te.dragStone&&te.targetStone&&!te.targetStone.classList.contains("flagstone-lock")&&j(te.dropStone,te.targetStone)&&(te.targetStone===L?L.appendChild(te.dragStone):te.targetStoneOverLeft?L.insertBefore(te.dragStone,te.targetStone):L.insertBefore(te.dragStone,te.targetStone.nextElementSibling)),te.clear()},dragLeave:function(){te.targetStone&&(te.targetStone.classList.remove("flagstone-dragover"),te.targetStone.classList.remove("flagstone-left"),te.targetStone.classList.remove("flagstone-right"),L.classList.remove("flagstone-dragover"))},drop:function(t){if(!te.dragStone)return!1;if(t.stopPropagation(),e.clearTimeout(te.autoDropTimer),te.dragStone!==this&&(this.classList.contains(B)||this===L)){if(te.targetStone=this,te.targetStone===L){if(!j(te.dragStone,te.targetStone))return te.clear(),!1;te.targetStone.appendChild(te.dragStone)}else if(te.targetStoneOverLeft){if(!j(te.dragStone,te.targetStone))return te.clear(),!1;te.targetStone.parentElement.insertBefore(te.dragStone,te.targetStone)}else{if(!j(te.dragStone,te.targetStone.nextElementSibling))return te.clear(),!1;te.targetStone.parentElement.insertBefore(te.dragStone,te.targetStone.nextElementSibling)}te.clear(),e.MutationObserver||ee()}return!1}};return ee=function(){w=Array.prototype.slice.call(L.children);for(var t=0,n=w.length;t<n;t++)w[t].classList.add(B);for(t=0;t<n;t++)w[t].setAttribute("draggable","false"),w[t].removeEventListener("mousedown",te.mousedown),w[t].removeEventListener("dragstart",te.dragStart),w[t].removeEventListener("touchstart",te.touchStart),w[t].removeEventListener("touchmove",te.touchMove),w[t].removeEventListener("dragover",te.dragOver),w[t].removeEventListener("dragleave",te.dragLeave),w[t].removeEventListener("dragend",te.dragEnd),w[t].removeEventListener("touchend",te.touchEnd),w[t].removeEventListener("drop",te.drop),w[t].removeEventListener("touchend",te.drop),w[t].removeEventListener("dragenter",te.dragEnter),L.removeEventListener("dragover",te.dragOver),L.removeEventListener("drop",te.drop);if(X)for(t=0;t<n;t++)w[t].classList.contains("flagstone-lock")||(w[t].setAttribute("draggable","true"),w[t].addEventListener("mousedown",te.mousedown),w[t].addEventListener("dragstart",te.dragStart),w[t].addEventListener("touchstart",te.touchStart),w[t].addEventListener("touchmove",te.touchMove),w[t].addEventListener("dragover",te.dragOver),w[t].addEventListener("dragleave",te.dragLeave),w[t].addEventListener("dragend",te.dragEnd),w[t].addEventListener("touchend",te.touchEnd),w[t].addEventListener("drop",te.drop),w[t].addEventListener("touchend",te.drop),Q&&w[t].addEventListener("dragenter",te.dragEnter),L.addEventListener("dragover",te.dragOver),L.addEventListener("drop",te.drop));(z||P)&&(z&&w.sort(function(){return.5-Math.random()}),P&&r());var a=L.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=L.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",l),a[t].addEventListener("click",l),a[t].removeEventListener("keydown",l),a[t].addEventListener("keydown",l);for(a=L.getElementsByClassName("flagstone-resize-height"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",c),a[t].addEventListener("click",c),a[t].removeEventListener("keydown",c),a[t].addEventListener("keydown",c);s(),R&&e.setTimeout(i,R),e.setTimeout(function(){s(!0)},R)},function(){if(L.classList.add("flagstone-"+S+"-bed"),!t.getElementById("flagstone-"+S+"-styles")){var n=".flagstone-"+S+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(y+2*p)+"px;}",r=".flagstone-"+S+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+A+":0px;margin:0;}",a=".flagstone-"+S+"-bed__stone{transition:top "+N+"s "+_+","+A+" "+N+"s "+_+(M?",width "+N+"s "+_:"")+";}",o=n+r+a,s=t.createElement("style");s.type="text/css",s.id="flagstone-"+S+"-styles",s.appendChild(t.createTextNode(o)),t.head.appendChild(s)}if(ee(),e.removeEventListener("resize",f),e.addEventListener("resize",f),e.MutationObserver){var i=new MutationObserver(v);i.observe(L,{childList:!0})}}(),{adjust:u,destroy:m,resizeHeight:d,hide:a,reset:f,hardReset:ee}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);