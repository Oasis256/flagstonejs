/*
  FlagstoneJS v3.3.1
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=x.length;e<t;e++)Math.random()<O&&x.splice(e,0,!1)}function a(){h.style.visibility="hidden"}function o(){var t=[T],n=0,r=k.length;for(C=[];n<r;n++){if(n<T)x[n]?(x[n].style.top=y+"px",x[n].style[B]=w*n+(n?D*n+y:y)+"px",_&&(x[n].style.height=x[n].style.width),t[n]=k[n]+y,U(x[n],n),C.push([x[n]])):T>1&&(t[n]=w+y);else{var a=Math.min.apply(null,t),o=t.indexOf(a);x[n]?(x[n].style.top=a+D+"px",x[n].style[B]=w*o+(o?D*o+y:y)+"px",_&&(x[n].style.height=x[n].style.width),t[o]+=k[n]+D,U(x[n],n),C[o].push(x[n])):T>1&&(t[o]+=w+D)}h.style.height=(Math.max.apply(null,t)||k[0]+y)+y+"px"}e.setTimeout(function(){h.style.visibility="visible"})}function s(t){if(x.length){L=h.getBoundingClientRect().width,L<S+(y?2*y:0)&&(L=S),b=Math.floor(L/S),T=b>E?E:b,w=L/T-(D*(T-1)+2*y)/T,k=[];for(var n=0,r=x.length;n<r;n++)x[n]&&(x[n].style.width=w+"px",x[n].style.marginTop="0px"),k.push(_||!x[n]?w:x[n].offsetHeight);L===h.getBoundingClientRect().width||t?o():s(!0),A&&(t||e.setTimeout(function(){s(!0)},F))}}function i(){var t=Date.now(),n=h.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,i=n.length;o<i;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+q<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){s(!0)}))},I)}()}function l(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(M);)n=n.parentElement;h.removeChild(n),e.MutationObserver||Z()}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(s,Q)}function g(t){function n(){var t=r.getBoundingClientRect().height+a;for(i=0;i<d;i++)o[i].style.marginTop=t-m+"px";G=e[(J?"request":"cancel")+"AnimationFrame"](n)}if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var r=t.target;r&&!r.classList.contains(M);)r=r.parentElement;for(var a=e.parseFloat(r.style.top),o=[],s=!1,i=0,l=0,d=C.length,g=0;i<d&&!s;i++)for(l=0,g=C[i].length;l<g;l++)s&&o.push(C[i][l]),C[i][l]===r&&(s=!0);if(o.length){var m=e.parseFloat(o[0].style.top)-D;d=o.length,J=!1,e.cancelAnimationFrame(G),e.clearTimeout(K),J=!0,G=e.requestAnimationFrame(n),K=e.setTimeout(function(){J=!1,e.cancelAnimationFrame(G)},j)}}}function m(){e.clearTimeout(V),V=e.setTimeout(s,X)}function v(){a(),e.clearTimeout(Y),Y=e.setTimeout(Z)}function f(){e.removeEventListener("resize",m),t.head.removeChild(t.getElementById("flagstone-"+c+"-styles"))}function u(e){e.margin||0===e.margin?(y=e.margin,D=e.margin):(y=e.bedPadding||y,D=e.stonesMargin||D),S=e.minWidth||S,E=e.maxColumns||E,W=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:W,U=e.callback||U,Z()}var c=e.flagstone.index,p=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},h=p.elem,y=p.margin||0===p.margin?p.margin:p.bedPadding||0===p.bedPadding?p.bedPadding:10,L=0,S=p.minWidth||280,E=p.maxColumns||5,b=0,T=0,x=[],D=p.margin||0===p.margin?p.margin:p.stonesMargin||0===p.stonesMargin?p.stonesMargin:10,w=L/T-D*(T+1)/T,k=[],C=[],M="flagstone-"+c+"-bed__stone",A=p.flow,B=p.direction?p.direction.toLowerCase():"left",P=p.random,O=p.spaceFrequency||.4,z=p.space,F=p.animationDuration||0,N=p.animationDuration?p.animationDuration/1e3:0,R=p.animationTimingFunction||"linear",X=p.resizeDelay||0===p.resizeDelay?p.resizeDelay:250,_=p.square,q=p.imagesLoadedQueryDuration||2500,I=p.imagesLoadedQueryFrequency||100,W=p.dragAndDrop,H=p.dragAndDropAutoDelay,Q=p.eventResetDelay||0,j=p.eventResizeDuration||0,G=null,J=!1,K=null,U=p.callback||function(){},V=null,Y=null,Z=null,$={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,autoDropTimer:null,autoDrop:function(){$.targetStone.classList.contains(M)&&($.targetStoneMouseXPercent<.5?$.dragStone!==$.targetStone.previousElementSibling&&($.targetStone.parentElement.insertBefore($.dragStone,$.targetStone),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-dragover")):$.dragStone!==$.targetStone.nextElementSibling&&($.targetStone.parentElement.insertBefore($.dragStone,$.targetStone.nextElementSibling),$.targetStone.classList.remove("flagstone-right"),$.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout($.autoDropTimer),$.autoDropTimer=e.setTimeout($.autoDrop,H))},dragStart:function(e){e.dataTransfer.setData("text",this.id),$.dragStone=this,$.dragStone.classList.add("flagstone-drag")},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==$.dragStone&&this!==$.targetStone&&this!==h&&(e.clearTimeout($.autoDropTimer),$.autoDropTimer=e.setTimeout($.autoDrop,H))},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==$.dragStone&&this.hasAttribute("draggable")?($.targetStone=this,$.targetStone.classList.add("flagstone-dragover"),$.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,$.targetStoneMouseXPercent<.5?($.targetStone.classList.remove("flagstone-right"),$.targetStone.classList.add("flagstone-left")):($.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===h&&this.classList.add("flagstone-dragover")},dragEnd:function(){$.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){$.targetStone&&(h.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-right"))},drop:function(t){return t.stopPropagation(),e.clearTimeout($.autoDropTimer),$.dragStone===this||!this.hasAttribute("draggable")&&this!==h||($.targetStone=this,$.targetStone===h?$.targetStone.appendChild($.dragStone):$.targetStoneMouseXPercent<.5?$.targetStone.parentElement.insertBefore($.dragStone,$.targetStone):$.targetStone.parentElement.insertBefore($.dragStone,$.targetStone.nextElementSibling),$.targetStone.classList.remove("flagstone-dragover"),$.targetStone.classList.remove("flagstone-left"),$.targetStone.classList.remove("flagstone-right"),$.dragStone.classList.remove("flagstone-drag"),e.MutationObserver||Z()),!1}};return Z=function(){x=Array.prototype.slice.call(h.children);for(var t=0,n=x.length;t<n;t++)x[t].classList.add(M);for(t=0;t<n;t++)x[t].setAttribute("draggable","false"),x[t].removeEventListener("dragstart",$.dragStart),x[t].removeEventListener("dragover",$.dragOver),x[t].removeEventListener("dragleave",$.dragLeave),x[t].removeEventListener("dragend",$.dragEnd),x[t].removeEventListener("drop",$.drop),x[t].removeEventListener("dragenter",$.dragEnter),h.removeEventListener("dragover",$.dragOver),h.removeEventListener("drop",$.drop);if(W)for(t=0;t<n;t++)x[t].setAttribute("draggable","true"),x[t].addEventListener("dragstart",$.dragStart),x[t].addEventListener("dragover",$.dragOver),x[t].addEventListener("dragleave",$.dragLeave),x[t].addEventListener("dragend",$.dragEnd),x[t].addEventListener("drop",$.drop),H&&x[t].addEventListener("dragenter",$.dragEnter),h.addEventListener("dragover",$.dragOver),h.addEventListener("drop",$.drop);(P||z)&&(P&&x.sort(function(){return.5-Math.random()}),z&&r());var a=h.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",l),a[t].addEventListener("click",l),a[t].removeEventListener("keydown",l),a[t].addEventListener("keydown",l);for(a=h.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=h.getElementsByClassName("flagstone-resize"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);s(),F&&e.setTimeout(i,F),e.setTimeout(function(){s(!0)},F)},function(){if(h.classList.add("flagstone-"+c+"-bed"),!t.getElementById("flagstone-"+c+"-styles")){var n=".flagstone-"+c+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(S+2*D)+"px;}",r=".flagstone-"+c+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+B+":0px;margin:0;}",a=".flagstone-"+c+"-bed__stone{transition:top "+N+"s "+R+","+B+" "+N+"s "+R+(A?",width "+N+"s "+R:"")+";}",o=n+r+a,s=t.createElement("style");s.type="text/css",s.id="flagstone-"+c+"-styles",s.appendChild(t.createTextNode(o)),t.head.appendChild(s)}if(Z(),e.removeEventListener("resize",m),e.addEventListener("resize",m),e.MutationObserver){var i=new MutationObserver(v);i.observe(h,{childList:!0})}}(),{adjust:u,destroy:f,hide:a,reset:m,hardReset:Z}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);