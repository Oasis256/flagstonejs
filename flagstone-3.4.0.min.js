/*
  FlagstoneJS v3.4.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=x.length;e<t;e++)Math.random()<O&&x.splice(e,0,!1)}function a(){p.style.visibility="hidden"}function o(){var t=[T],n=0,r=w.length;for(C=[];n<r;n++){if(n<T)x[n]?(x[n].style.top=S+"px",x[n].style[B]=k*n+(n?D*n+S:S)+"px",_&&(x[n].style.height=x[n].style.width),t[n]=w[n]+S,U(x[n],n),C.push([x[n]])):T>1&&(t[n]=k+S);else{var a=Math.min.apply(null,t),o=t.indexOf(a);x[n]?(x[n].style.top=a+D+"px",x[n].style[B]=k*o+(o?D*o+S:S)+"px",_&&(x[n].style.height=x[n].style.width),t[o]+=w[n]+D,U(x[n],n),C[o].push(x[n])):T>1&&(t[o]+=k+D)}p.style.height=(Math.max.apply(null,t)||w[0]+S)+S+"px"}e.setTimeout(function(){p.style.visibility="visible"})}function s(t){if(x.length){L=p.getBoundingClientRect().width,L<E+(S?2*S:0)&&(L=E),b=Math.floor(L/E),T=b>y?y:b,k=L/T-(D*(T-1)+2*S)/T,w=[];for(var n=0,r=x.length;n<r;n++)x[n]&&(x[n].style.width=k+"px",x[n].style.marginTop="0px"),w.push(_||!x[n]?k:x[n].offsetHeight);L===p.getBoundingClientRect().width||t?o():s(!0),t||e.setTimeout(function(){s(!0)},F)}}function i(){var t=Date.now(),n=p.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,i=n.length;o<i;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+q<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){s(!0)}))},I)}()}function l(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(M);)n=n.parentElement;p.removeChild(n),e.MutationObserver||$()}}function g(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(s,j)}function d(t){function n(){var t=r.getBoundingClientRect().height+a;for(i=0;i<g;i++)o[i].style.marginTop=t-c+"px";G=e[(J?"request":"cancel")+"AnimationFrame"](n)}if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var r=t.target;r&&!r.classList.contains(M);)r=r.parentElement;for(var a=e.parseFloat(r.style.top),o=[],s=!1,i=0,l=0,g=C.length,d=0;i<g&&!s;i++)for(l=0,d=C[i].length;l<d;l++)s&&o.push(C[i][l]),C[i][l]===r&&(s=!0);if(o.length){var c=e.parseFloat(o[0].style.top)-D;g=o.length,J=!1,e.cancelAnimationFrame(G),e.clearTimeout(K),J=!0,G=e.requestAnimationFrame(n),K=e.setTimeout(function(){J=!1,e.cancelAnimationFrame(G)},Y)}}}function c(){e.clearTimeout(V),V=e.setTimeout(s,R)}function v(){a(),e.clearTimeout(Z),Z=e.setTimeout($)}function f(){e.removeEventListener("resize",c),t.head.removeChild(t.getElementById("flagstone-"+m+"-styles"))}function u(e){e.margin||0===e.margin?(S=e.margin,D=e.margin):(S=e.bedPadding||S,D=e.stonesMargin||D),E=e.minWidth||E,y=e.maxColumns||y,W=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:W,Q=e.dropCallback||Q,U=e.callback||U,$()}var m=e.flagstone.index,h=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},p=h.elem,S=h.margin||0===h.margin?h.margin:h.bedPadding||0===h.bedPadding?h.bedPadding:10,L=0,E=h.minWidth||280,y=h.maxColumns||5,b=0,T=0,x=[],D=h.margin||0===h.margin?h.margin:h.stonesMargin||0===h.stonesMargin?h.stonesMargin:10,k=L/T-D*(T+1)/T,w=[],C=[],M="flagstone-"+m+"-bed__stone",A=h.flow,B=h.direction?h.direction.toLowerCase():"left",P=h.random,O=h.spaceFrequency||.4,z=h.space,F=h.animationDuration||0,N=h.animationDuration?h.animationDuration/1e3:0,X=h.animationTimingFunction||"linear",R=h.resizeDelay||0===h.resizeDelay?h.resizeDelay:250,_=h.square,q=h.imagesLoadedQueryDuration||2500,I=h.imagesLoadedQueryFrequency||100,W=h.dragAndDrop,H=h.dragAndDropAutoDelay,Q=h.dropCallback||function(){return!0},j=h.eventResetDelay||0,Y=h.eventResizeDuration||0,G=null,J=!1,K=null,U=h.callback||function(){},V=null,Z=null,$=null,ee={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,autoDropTimer:null,autoDrop:function(){ee.targetStone.classList.contains(M)&&(ee.targetStoneMouseXPercent<.5?ee.dragStone!==ee.targetStone.previousElementSibling&&(ee.targetStone.parentElement.insertBefore(ee.dragStone,ee.targetStone),ee.targetStone.classList.remove("flagstone-left"),ee.targetStone.classList.remove("flagstone-dragover")):ee.dragStone!==ee.targetStone.nextElementSibling&&(ee.targetStone.parentElement.insertBefore(ee.dragStone,ee.targetStone.nextElementSibling),ee.targetStone.classList.remove("flagstone-right"),ee.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout(ee.autoDropTimer),ee.autoDropTimer=e.setTimeout(ee.autoDrop,H))},clear:function(){ee.targetStone.classList.remove("flagstone-dragover"),ee.targetStone.classList.remove("flagstone-left"),ee.targetStone.classList.remove("flagstone-right"),ee.dragStone.classList.remove("flagstone-drag"),p.classList.remove("flagstone-dragover")},dragStart:function(e){e.dataTransfer&&e.dataTransfer.setData("text",this.id),ee.dragStone=this,ee.dragStone.classList.add("flagstone-drag")},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==ee.dragStone&&this!==ee.targetStone&&this!==p&&(e.clearTimeout(ee.autoDropTimer),ee.autoDropTimer=e.setTimeout(ee.autoDrop,H))},touchMove:function(e){e.preventDefault(),e.stopPropagation();for(var n=t.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY);n&&!n.hasAttribute("draggable");)n=n.parentElement;n&&(ee.targetStone&&ee.targetStone!==n&&(ee.targetStone.classList.remove("flagstone-dragover"),ee.targetStone.classList.remove("flagstone-left")),ee.targetStone=n,ee.targetStone===p?ee.targetStone.classList.add("flagstone-dragover"):ee.targetStone.classList.contains("flagstone-lock")||(ee.targetStone.classList.add("flagstone-dragover"),ee.targetStone.classList.add("flagstone-left")))},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==ee.dragStone&&this.hasAttribute("draggable")?(ee.targetStone=this,ee.targetStone.classList.add("flagstone-dragover"),ee.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,ee.targetStoneMouseXPercent<.5?(ee.targetStone.classList.remove("flagstone-right"),ee.targetStone.classList.add("flagstone-left")):(ee.targetStone.classList.remove("flagstone-left"),ee.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover"),ee.targetStone!==p&&p.classList.remove("flagstone-dragover")):this===p&&this.classList.add("flagstone-dragover")},dragEnd:function(){ee.dragStone.classList.remove("flagstone-drag")},touchEnd:function(){ee.targetStone&&!ee.targetStone.classList.contains("flagstone-lock")&&Q(ee.dropStone,ee.targetStone)&&p.insertBefore(ee.dragStone,ee.targetStone),ee.clear()},dragLeave:function(){ee.targetStone&&(p.classList.remove("flagstone-dragover"),ee.targetStone.classList.remove("flagstone-dragover"),ee.targetStone.classList.remove("flagstone-left"),ee.targetStone.classList.remove("flagstone-right"))},drop:function(t){if(t.stopPropagation(),e.clearTimeout(ee.autoDropTimer),ee.dragStone!==this&&(this.hasAttribute("draggable")||this===p)){if(ee.targetStone=this,ee.targetStone===p){if(!Q(ee.dragStone,ee.targetStone))return ee.clear(),!1;ee.targetStone.appendChild(ee.dragStone)}else if(ee.targetStoneMouseXPercent<.5){if(!Q(ee.dragStone,ee.targetStone))return ee.clear(),!1;ee.targetStone.parentElement.insertBefore(ee.dragStone,ee.targetStone)}else{if(!Q(ee.dragStone,ee.targetStone.nextElementSibling))return ee.clear(),!1;ee.targetStone.parentElement.insertBefore(ee.dragStone,ee.targetStone.nextElementSibling)}ee.clear(),e.MutationObserver||$()}return!1}};return $=function(){x=Array.prototype.slice.call(p.children);for(var t=0,n=x.length;t<n;t++)x[t].classList.add(M);for(t=0;t<n;t++)x[t].setAttribute("draggable","false"),x[t].removeEventListener("dragstart",ee.dragStart),x[t].removeEventListener("touchstart",ee.dragStart),x[t].removeEventListener("touchmove",ee.touchMove),x[t].removeEventListener("dragover",ee.dragOver),x[t].removeEventListener("dragleave",ee.dragLeave),x[t].removeEventListener("dragend",ee.dragEnd),x[t].removeEventListener("touchend",ee.touchEnd),x[t].removeEventListener("drop",ee.drop),x[t].removeEventListener("touchend",ee.drop),x[t].removeEventListener("dragenter",ee.dragEnter),p.removeEventListener("dragover",ee.dragOver),p.removeEventListener("drop",ee.drop);if(W)for(t=0;t<n;t++)x[t].classList.contains("flagstone-lock")||(x[t].setAttribute("draggable","true"),x[t].addEventListener("dragstart",ee.dragStart),x[t].addEventListener("touchstart",ee.dragStart),x[t].addEventListener("touchmove",ee.touchMove),x[t].addEventListener("dragover",ee.dragOver),x[t].addEventListener("dragleave",ee.dragLeave),x[t].addEventListener("dragend",ee.dragEnd),x[t].addEventListener("touchend",ee.touchEnd),x[t].addEventListener("drop",ee.drop),x[t].addEventListener("touchend",ee.drop),H&&x[t].addEventListener("dragenter",ee.dragEnter),p.addEventListener("dragover",ee.dragOver),p.addEventListener("drop",ee.drop));(P||z)&&(P&&x.sort(function(){return.5-Math.random()}),z&&r());var a=p.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",l),a[t].addEventListener("click",l),a[t].removeEventListener("keydown",l),a[t].addEventListener("keydown",l);for(a=p.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=p.getElementsByClassName("flagstone-resize"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);s(),F&&e.setTimeout(i,F),e.setTimeout(function(){s(!0)},F)},function(){if(p.classList.add("flagstone-"+m+"-bed"),!t.getElementById("flagstone-"+m+"-styles")){var n=".flagstone-"+m+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(E+2*S)+"px;}",r=".flagstone-"+m+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+B+":0px;margin:0;}",a=".flagstone-"+m+"-bed__stone{transition:top "+N+"s "+X+","+B+" "+N+"s "+X+(A?",width "+N+"s "+X:"")+";}",o=n+r+a,s=t.createElement("style");s.type="text/css",s.id="flagstone-"+m+"-styles",s.appendChild(t.createTextNode(o)),t.head.appendChild(s)}if($(),e.removeEventListener("resize",c),e.addEventListener("resize",c),e.MutationObserver){var i=new MutationObserver(v);i.observe(p,{childList:!0})}}(),{adjust:u,destroy:f,hide:a,reset:c,hardReset:$}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);