/*
  FlagstoneJS v3.1.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=w.length;e<t;e++)Math.random()<B&&w.splice(e,0,!1)}function a(){p.style.visibility="hidden"}function o(){for(var t=[x],n=0,r=D.length;n<r;n++){if(n<x)if(w[n]){var a=w[n].style.width.toString().replace(/(\d+).+/,"$1");w[n].style.width=a+"px",w[n].style.top=L+"px",w[n].style[M]=C*n+(n?k*n+L:L)+"px",w[n].style.height=q?a+"px":"auto",t[n]=D[n]+L,F(w[n],n)}else x>1&&(t[n]=C+L);else{var o=Math.min.apply(null,t),s=t.indexOf(o);if(w[n]){var i=w[n].style.width.toString().replace(/(\d+).+/,"$1");w[n].style.width=i+"px",w[n].style.top=o+k+"px",w[n].style[M]=C*s+(s?k*s+L:L)+"px",w[n].style.height=q?i+"px":"auto",t[s]+=D[n]+k,F(w[n],n)}else x>1&&(t[s]+=C+k)}p.style.height=(Math.max.apply(null,t)||D[0]+L)+L+"px"}e.setTimeout(function(){p.style.visibility="visible"})}function s(e){if(w.length){y=p.getBoundingClientRect().width,y<S+(L?2*L:0)&&(y=S),b=Math.floor(y/S),x=b>E?E:b,C=y/x-(k*(x-1)+2*L)/x,D=[];for(var t=0,n=w.length;t<n;t++)w[t]&&(w[t].style.width=C+"px"),D.push(q||!w[t]?C:w[t].offsetHeight);y===p.getBoundingClientRect().width||e?o():s(!0)}}function i(){var t=Date.now(),n=p.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,i=n.length;o<i;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+N<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){s(!0)}))},X)}()}function d(e){if("keydown"!==e.type||13===e.keyCode||32===e.keyCode){for(var t=e.target,n="flagstone-"+u+"-bed__stone";t&&!t.classList.contains(n);)t=t.parentElement;t&&t.classList.contains(n)&&p.removeChild(t)}}function g(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(s,R)}function l(){w=Array.prototype.slice.call(p.children);for(var t=0,n=w.length;t<n;t++)w[t].classList.add("flagstone-"+u+"-bed__stone");for(t=0;t<n;t++)w[t].setAttribute("draggable","false"),w[t].removeEventListener("dragstart",Q.dragStart),w[t].removeEventListener("dragover",Q.dragOver),w[t].removeEventListener("dragleave",Q.dragLeave),w[t].removeEventListener("dragend",Q.dragEnd),w[t].removeEventListener("drop",Q.drop),p.removeEventListener("dragover",Q.dragOver),p.removeEventListener("drop",Q.drop);if(I)for(t=0;t<n;t++)w[t].setAttribute("draggable","true"),w[t].addEventListener("dragstart",Q.dragStart),w[t].addEventListener("dragover",Q.dragOver),w[t].addEventListener("dragleave",Q.dragLeave),w[t].addEventListener("dragend",Q.dragEnd),w[t].addEventListener("drop",Q.drop),p.addEventListener("dragover",Q.dragOver),p.addEventListener("drop",Q.drop);(T||P)&&(T&&w.sort(function(){return.5-Math.random()}),P&&r());var a=p.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=p.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);s(),z&&e.setTimeout(i,z),e.setTimeout(function(){s(!0)},z)}function f(){e.clearTimeout(W),W=e.setTimeout(s,_)}function v(){a(),e.clearTimeout(H),H=e.setTimeout(l)}function c(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+u+"-styles"))}function m(e){e.margin||0===e.margin?(L=e.margin,k=e.margin):(L=e.bedPadding||L,k=e.stonesMargin||k),S=e.minWidth||S,E=e.maxColumns||E,q=e.square===!0||e.square===!1?e.square:q,I=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:I,F=e.callback||F,l()}var u=e.flagstone.index,h=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},p=h.elem,L=h.margin||0===h.margin?h.margin:h.bedPadding||0===h.bedPadding?h.bedPadding:10,y=0,S=h.minWidth||280,E=h.maxColumns||5,b=0,x=0,w=[],k=h.margin||0===h.margin?h.margin:h.stonesMargin||0===h.stonesMargin?h.stonesMargin:10,C=y/x-k*(x+1)/x,D=[],M=h.direction?h.direction.toLowerCase():"left",T=h.random,B=h.spaceFrequency||.4,P=h.space,z=h.animationDuration||0,A=h.animationDuration?h.animationDuration/1e3:0,O=h.animationTimingFunction||"linear",_=h.resizeDelay||0===h.resizeDelay?h.resizeDelay:250,q=h.square,N=h.imagesLoadedQueryDuration||2500,X=h.imagesLoadedQueryFrequency||100,I=h.dragAndDrop,R=h.eventResetDelay||0,F=h.callback||function(){},W=null,H=null,Q={dragStone:null,targetStone:null,targetStoneMouseXPercent:0,dragStart:function(){Q.dragStone=this,Q.dragStone.classList.add("flagstone-drag")},dragOver:function(e){e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",this!==Q.dragStone&&this.hasAttribute("draggable")?(Q.targetStone=this,Q.targetStone.classList.add("flagstone-dragover"),Q.targetStoneMouseXPercent=e.offsetX/this.offsetWidth,Q.targetStoneMouseXPercent<.5?(Q.targetStone.classList.remove("flagstone-right"),Q.targetStone.classList.add("flagstone-left")):(Q.targetStone.classList.remove("flagstone-left"),Q.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover")):this===p&&this.classList.add("flagstone-dragover")},dragEnd:function(){Q.dragStone.classList.remove("flagstone-drag")},dragLeave:function(){Q.targetStone&&(p.classList.remove("flagstone-dragover"),Q.targetStone.classList.remove("flagstone-dragover"),Q.targetStone.classList.remove("flagstone-left"),Q.targetStone.classList.remove("flagstone-right"))},drop:function(e){return e.stopPropagation(),Q.dragStone===this||!this.hasAttribute("draggable")&&this!==p||(Q.targetStone=this,Q.targetStone===p?Q.targetStone.appendChild(Q.dragStone):Q.targetStoneMouseXPercent<.5?Q.targetStone.parentElement.insertBefore(Q.dragStone,Q.targetStone):Q.targetStone.parentElement.insertBefore(Q.dragStone,Q.targetStone.nextElementSibling),Q.targetStone.classList.remove("flagstone-dragover"),Q.targetStone.classList.remove("flagstone-left"),Q.targetStone.classList.remove("flagstone-right"),Q.dragStone.classList.remove("flagstone-drag")),!1}};return function(){if(p.classList.add("flagstone-"+u+"-bed"),!t.getElementById("flagstone-"+u+"-styles")){var n=".flagstone-"+u+"-bed{box-sizing:border-box;position:relative;min-width:"+(S+2*k)+"px;}",r=".flagstone-"+u+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+M+":0px;}",a=".flagstone-"+u+"-bed__stone{-webkit-transition:top "+A+"s "+O+",left "+A+"s "+O+",right "+A+"s "+O+";-moz-transition:top "+A+"s "+O+",left "+A+"s "+O+",right "+A+"s "+O+";-ms-transition:top "+A+"s "+O+",left "+A+"s "+O+",right "+A+"s "+O+";-o-transition:top "+A+"s "+O+",left "+A+"s "+O+",right "+A+"s "+O+";transition:top "+A+"s "+O+",left "+A+"s "+O+",right "+A+"s "+O+";}",o=n+r+a,s=t.createElement("style");s.type="text/css",s.id="flagstone-"+u+"-styles",s.appendChild(t.createTextNode(o)),t.head.appendChild(s)}l(),e.removeEventListener("resize",f),e.addEventListener("resize",f),e.setTimeout(function(){p.addEventListener("DOMSubtreeModified",v)})}(),{adjust:m,destroy:c,hide:a,reset:f,hardReset:l}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);