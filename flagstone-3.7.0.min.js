/*
  FlagstoneJS v3.7.0
  (c) 2015-2017 Depth Development. http://depthdev.com
  License: MIT
*/
!function(e,t){"use strict";e.flagstone=function(n){function r(n){function r(){for(var e=0,t=k.length;e<t;e++)Math.random()<q&&k.splice(e,0,!1)}function a(){L.style.visibility="hidden"}function o(){L.style.visibility="visible"}function s(){var t=[w],n=0,r=O.length;for(M=[];n<r;n++){if(n<w)k[n]?(k[n].style.top=E+"px",k[n].style[z]=A*n+(n?C*n+E:E)+"px",Y&&(k[n].style.height=k[n].style.width),t[n]=O[n]+E,se(k[n],n),M.push([k[n]])):w>1&&(t[n]=A+E);else{var a=Math.min.apply(null,t),s=t.indexOf(a);k[n]?(k[n].style.top=a+C+"px",k[n].style[z]=A*s+(s?C*s+E:E)+"px",Y&&(k[n].style.height=k[n].style.width),t[s]+=O[n]+C,se(k[n],n),M[s].push(k[n])):w>1&&(t[s]+=A+C)}T=(Math.max.apply(null,t)||O[0]+E)+E,L.style.height=T+"px"}e.setTimeout(o)}function i(t){if(k.length){y=L.offsetWidth,y<b+(E?2*E:0)&&(y=b),D=Math.floor(y/b),w=D>x?x:D,A=y/w-(C*(w-1)+2*E)/w,O=[];for(var n=0,r=k.length;n<r;n++)k[n]&&(k[n].style.width=A+"px",k[n].style.marginTop="0px"),O.push(Y||!k[n]?A:k[n].offsetHeight);y===L.offsetWidth||t?s():i(!0),t||e.setTimeout(function(){i(!0)},H)}}function l(){var t=Date.now(),n=L.getElementsByTagName("img");n.length&&!function(){var r=e.setInterval(function(){for(var a=[],o=0,s=n.length;o<s;o++)a[o]=n[o].naturalHeight;(a.indexOf(0)===-1||t+Z<Date.now())&&(e.clearInterval(r),e.setTimeout(function(){i(!0)}))},G)}()}function g(t){if("keydown"!==t.type||13===t.keyCode||32===t.keyCode){for(var n=t.target;n&&!n.classList.contains(B);)n=n.parentElement;L.removeChild(n),!e.MutationObserver&&ie&&ce()}}function d(t){"keydown"===t.type&&13!==t.keyCode&&32!==t.keyCode||e.setTimeout(i,V)}function c(t){function n(){for(var t=0,n=M.length,r=0,a=0;t<n&&!g;t++)for(r=0,a=M[t].length;r<a;r++)g&&(i.push(M[t][r]),l.push(e.parseInt(M[t][r].style.marginTop,10)||0)),M[t][r]===o&&(g=!0)}function r(){for(var t=0,n=w,a=[];t<n;t++){var o=M[t][M[t].length-1],s=e.parseInt(o.style.top,10)+(e.parseInt(o.style.marginTop,10)||0)+o.offsetHeight+E;a.push(s)}var i=Math.max.apply(null,a);L.style.height=i+"px",ee=e[(te?"request":"cancel")+"AnimationFrame"](r)}function a(){function t(){for(var r=o.offsetHeight+s,g=r-a,d=0;d<n;d++)i[d].style.marginTop=g+l[d]+"px";re=e[(ae?"request":"cancel")+"AnimationFrame"](t)}var n=i.length,a=e.parseInt(i[0].style.top,10)-C+l[0];ae=!0,re=e.requestAnimationFrame(t),oe=e.setTimeout(function(){ae=!1,e.cancelAnimationFrame(re)},$),te=!0,ee=e.requestAnimationFrame(r),ne=e.setTimeout(function(){te=!1,e.cancelAnimationFrame(ee)},$)}for(var o=t;o&&!o.classList.contains(B);)o=o.parentElement;var s=e.parseInt(o.style.top,10)+(e.parseInt(o.style.marginTop,10)||0),i=[],l=[],g=!1;return n(),te=!1,e.cancelAnimationFrame(ee),e.clearTimeout(ne),ae=!1,e.cancelAnimationFrame(re),e.clearTimeout(oe),i.length?void a():(te=!0,ee=e.requestAnimationFrame(r),void(ne=e.setTimeout(function(){te=!1,e.cancelAnimationFrame(ee)},$)))}function m(e){"keydown"===e.type&&13!==e.keyCode&&32!==e.keyCode||c(e.target)}function f(){e.clearTimeout(ge),ge=e.setTimeout(i,j)}function v(){e.clearTimeout(de),de=e.setTimeout(ce)}function u(){e.removeEventListener("resize",f),t.head.removeChild(t.getElementById("flagstone-"+S+"-styles"))}function h(e){e.margin||0===e.margin?(E=e.margin,C=e.margin):(E=e.bedPadding||E,C=e.stonesMargin||C),b=e.minWidth||b,x=e.maxColumns||x,J=e.dragAndDrop===!0||e.dragAndDrop===!1?e.dragAndDrop:J,U=e.dropCallback||U,se=e.callback||se,ce()}var S=e.flagstone.index,p=n?n.nodeName?{elem:n}:n:{elem:t.getElementsByClassName("flagstone")[0]},L=p.elem,E=p.margin||0===p.margin?p.margin:p.bedPadding||0===p.bedPadding?p.bedPadding:10,y=0,T=0,b=p.minWidth||280,x=p.maxColumns||5,D=0,w=0,k=[],C=p.margin||0===p.margin?p.margin:p.stonesMargin||0===p.stonesMargin?p.stonesMargin:10,A=y/w-C*(w+1)/w,O=[],M=[],B="flagstone-"+S+"-bed__stone",F=p.flow,z=p.direction?p.direction.toLowerCase():"left",I=p.assignReverseZIndexes,P=p.random,q=p.spaceFrequency||.4,N=p.space,H=p.animationDuration||0,R=p.animationDuration/1e3,W=p.animationTimingFunction||"linear",_=p.heightAnimationDuration||0,X=p.heightAnimationDuration/1e3,Q=p.heightAnimationTimingFunction||"linear",j=p.resizeDelay||0===p.resizeDelay?p.resizeDelay:250,Y=p.square,Z=p.imagesLoadedQueryDuration||2500,G=p.imagesLoadedQueryFrequency||100,J=p.dragAndDrop,K=p.dragAndDropAutoDelay,U=p.dropCallback||function(){return!0},V=p.eventResetDelay||0,$=p.eventResizeHeightDuration||0,ee=null,te=!1,ne=null,re=null,ae=!1,oe=null,se=p.callback||function(){},ie=p.watch!==!1,le=p.watchAll,ge=null,de=null,ce=null,me={targetElem:null,dragStone:null,targetStone:null,targetStoneOverLeft:0,autoDropTimer:null,autoDrop:function(){me.targetStone.classList.contains(B)&&(me.targetStoneOverLeft?me.dragStone!==me.targetStone.previousElementSibling&&(me.targetStone.parentElement.insertBefore(me.dragStone,me.targetStone),me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.remove("flagstone-dragover")):me.dragStone!==me.targetStone.nextElementSibling&&(me.targetStone.parentElement.insertBefore(me.dragStone,me.targetStone.nextElementSibling),me.targetStone.classList.remove("flagstone-right"),me.targetStone.classList.remove("flagstone-dragover")),e.clearTimeout(me.autoDropTimer),me.autoDropTimer=e.setTimeout(me.autoDrop,K))},clear:function(){me.dragStone&&(me.dragStone.classList.remove("flagstone-drag"),me.dragStone=null),me.targetStone&&(me.targetStoneOverLeft=0,me.targetStone.classList.remove("flagstone-dragover"),me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.remove("flagstone-right"),me.targetStone=null),L.classList.remove("flagstone-dragover")},getTargetElem:function(e){for(me.targetElem=e.target instanceof HTMLElement?e.target:e.target.parentElement;me.targetElem&&!me.targetElem.classList.contains("flagstone-drag-handle");)me.targetElem=me.targetElem.parentElement;if(me.targetElem)for(me.dragStone=me.targetElem;me.dragStone&&!me.dragStone.classList.contains(B);)me.dragStone=me.dragStone.parentElement},mousedown:function(e){me.getTargetElem(e)},dragStart:function(e){return!!me.targetElem&&(me.dragStone.classList.add("flagstone-drag"),void(e.dataTransfer&&e.dataTransfer.setData("text",this.id)))},touchStart:function(e){me.getTargetElem(e),me.dragStart(e)},dragEnter:function(t){t.preventDefault(),t.stopPropagation(),this!==me.dragStone&&this!==me.targetStone&&this!==L&&(e.clearTimeout(me.autoDropTimer),me.autoDropTimer=e.setTimeout(me.autoDrop,K))},touchMove:function(e){if(!me.dragStone)return!1;e.preventDefault(),e.stopPropagation();for(var n=t.elementFromPoint(e.touches[0].clientX,e.touches[0].clientY),r=n;r&&!r.classList.contains(B);)r=r.parentElement;r?(L.classList.remove("flagstone-dragover"),me.targetStoneOverLeft=r.getBoundingClientRect().left+r.offsetWidth/2>e.touches[0].clientX,me.targetStone&&me.targetStone!==r&&(me.targetStone.classList.remove("flagstone-dragover"),me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.remove("flagstone-right")),me.targetStone=r,me.targetStone.classList.contains("flagstone-lock")||(me.targetStone.classList.add("flagstone-dragover"),me.targetStoneOverLeft?(me.targetStone.classList.remove("flagstone-right"),me.targetStone.classList.add("flagstone-left")):(me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.add("flagstone-right")))):n===L&&(me.targetStone.classList.remove("flagstone-dragover"),me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.remove("flagstone-right"),L.classList.add("flagstone-dragover"),me.targetStone=L)},dragOver:function(e){return!!me.dragStone&&(e.preventDefault(),e.stopPropagation(),e.dataTransfer.dropEffect="move",void(this!==me.dragStone&&this.classList.contains(B)?(me.targetStone=this,me.targetStone.classList.add("flagstone-dragover"),me.targetStoneOverLeft=this.getBoundingClientRect().left+this.offsetWidth/2>e.clientX,me.targetStoneOverLeft?(me.targetStone.classList.remove("flagstone-right"),me.targetStone.classList.add("flagstone-left")):(me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.add("flagstone-right")),this.classList.remove("flagstone-dragover"),me.targetStone!==L&&L.classList.remove("flagstone-dragover")):this===L&&this.classList.add("flagstone-dragover")))},dragEnd:function(){me.clear()},touchEnd:function(){me.dragStone&&me.targetStone&&!me.targetStone.classList.contains("flagstone-lock")&&U(me.dropStone,me.targetStone)&&(me.targetStone===L?L.appendChild(me.dragStone):me.targetStoneOverLeft?L.insertBefore(me.dragStone,me.targetStone):L.insertBefore(me.dragStone,me.targetStone.nextElementSibling)),me.clear()},dragLeave:function(){me.targetStone&&(me.targetStone.classList.remove("flagstone-dragover"),me.targetStone.classList.remove("flagstone-left"),me.targetStone.classList.remove("flagstone-right"),L.classList.remove("flagstone-dragover"))},drop:function(t){if(!me.dragStone)return!1;if(t.stopPropagation(),e.clearTimeout(me.autoDropTimer),me.dragStone!==this&&(this.classList.contains(B)||this===L)){if(me.targetStone=this,me.targetStone===L){if(!U(me.dragStone,me.targetStone))return me.clear(),!1;me.targetStone.appendChild(me.dragStone)}else if(me.targetStoneOverLeft){if(!U(me.dragStone,me.targetStone))return me.clear(),!1;me.targetStone.parentElement.insertBefore(me.dragStone,me.targetStone)}else{if(!U(me.dragStone,me.targetStone.nextElementSibling))return me.clear(),!1;me.targetStone.parentElement.insertBefore(me.dragStone,me.targetStone.nextElementSibling)}me.clear(),!e.MutationObserver&&ie&&ce()}return!1}};return ce=function(){k=Array.prototype.slice.call(L.children);for(var t=0,n=k.length;t<n;t++)k[t].classList.add(B),I&&(k[t].style.zIndex=n-t);for(t=0;t<n;t++)k[t].setAttribute("draggable","false"),k[t].removeEventListener("mousedown",me.mousedown),k[t].removeEventListener("dragstart",me.dragStart),k[t].removeEventListener("touchstart",me.touchStart),k[t].removeEventListener("touchmove",me.touchMove),k[t].removeEventListener("dragover",me.dragOver),k[t].removeEventListener("dragleave",me.dragLeave),k[t].removeEventListener("dragend",me.dragEnd),k[t].removeEventListener("touchend",me.touchEnd),k[t].removeEventListener("drop",me.drop),k[t].removeEventListener("touchend",me.drop),k[t].removeEventListener("dragenter",me.dragEnter);if(L.removeEventListener("dragover",me.dragOver),L.removeEventListener("drop",me.drop),J){for(t=0;t<n;t++)k[t].classList.contains("flagstone-lock")||(k[t].setAttribute("draggable","true"),k[t].addEventListener("mousedown",me.mousedown),k[t].addEventListener("dragstart",me.dragStart),k[t].addEventListener("touchstart",me.touchStart),k[t].addEventListener("touchmove",me.touchMove),k[t].addEventListener("dragover",me.dragOver),k[t].addEventListener("dragleave",me.dragLeave),k[t].addEventListener("dragend",me.dragEnd),k[t].addEventListener("touchend",me.touchEnd),k[t].addEventListener("drop",me.drop),k[t].addEventListener("touchend",me.drop),K&&k[t].addEventListener("dragenter",me.dragEnter),k[t].getElementsByClassName("flagstone-drag-handle").length||k[t].classList.add("flagstone-drag-handle"));L.addEventListener("dragover",me.dragOver),L.addEventListener("drop",me.drop)}(P||N)&&(P&&k.sort(function(){return.5-Math.random()}),N&&r());var a=L.getElementsByClassName("flagstone-remove");for(t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",g),a[t].addEventListener("click",g),a[t].removeEventListener("keydown",g),a[t].addEventListener("keydown",g);for(a=L.getElementsByClassName("flagstone-reset"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",d),a[t].addEventListener("click",d),a[t].removeEventListener("keydown",d),a[t].addEventListener("keydown",d);for(a=L.getElementsByClassName("flagstone-resize-height"),t=0,n=a.length;t<n;t++)a[t].removeEventListener("click",m),a[t].addEventListener("click",m),a[t].removeEventListener("keydown",m),a[t].addEventListener("keydown",m);i(),H&&e.setTimeout(l,H),e.setTimeout(function(){i(!0)},H)},function(){if(a(),L.classList.add("flagstone-"+S+"-bed"),!t.getElementById("flagstone-"+S+"-styles")){var n=".flagstone-"+S+"-bed{box-sizing:border-box;list-style-type:none;overflow:hidden;position:relative;min-width:"+(b+2*E)+"px;}",r=".flagstone-"+S+"-bed__stone{box-sizing:border-box;position:absolute;top:0px;"+z+":0px;margin:0;}",o=".flagstone-"+S+"-bed__stone{transition:top "+R+"s "+W+","+z+" "+R+"s "+W+(F?",width "+R+"s "+W:"")+(_?",height "+X+"s "+Q:"")+";}",s=n+r+o,i=t.createElement("style");i.type="text/css",i.id="flagstone-"+S+"-styles",i.appendChild(t.createTextNode(s)),t.head.appendChild(i)}if(ce(),e.removeEventListener("resize",f),e.addEventListener("resize",f),(ie||le)&&e.MutationObserver){var l=new MutationObserver(v);l.observe(L,{childList:!0,subtree:le})}}(),{adjust:h,destroy:u,resizeHeight:c,hide:a,reset:f,hardReset:ce}}return e.flagstone.index++,new r(n)},e.flagstone.index=-1}(window,document);